!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).SVGRealRenderer=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function o(e,t,o){return e(o={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&o.path)}},o.exports),o.exports}var r=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0;var o=function(){function e(e){var t=this;this.eventHandlers={},e.forEach((function(e){t.eventHandlers[e]=new Map}))}return e.prototype.on=function(e,t,o){this.eventHandlers[e].has(t)||this.eventHandlers[e].set(t,o)},e.prototype.off=function(e,t){this.eventHandlers[e].delete(t)},e.prototype.emit=function(e,t){this.eventHandlers[e].forEach((function(e){e(t)}))},e}();t.EventEmitter=o})),s=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RealRendererEventList=void 0,t.RealRendererEventList=["start-render"]})),n=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getRGBColorString=void 0,t.getRGBColorString=function(e){return"rgb("+255*e[0]+", "+255*e[1]+", "+255*e[2]+")"}})),i=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Path=void 0;var o=function(){function e(e,t){var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",e),this.node=o,this.section=t}return e.prototype.export=function(){return{type:"path",data:this.node.outerHTML.toString(),section:this.section}},e.prototype.import=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.innerHTML=e,this.node=t.firstChild,t.removeChild(this.node),t.remove()},e.prototype.updatePath=function(e){this.node.setAttribute("d",e)},e.prototype.appendPath=function(e){this.node.setAttribute("d",this.node.getAttribute("d")+" "+e)},e.prototype.setStroke=function(e){this.node.setAttribute("stroke",e)},e.prototype.setFill=function(e){this.node.setAttribute("fill",e)},e.prototype.setStrokeWidth=function(e){this.node.setAttribute("stroke-width",e.toString())},e.prototype.delete=function(){this.node.remove()},e}();t.Path=o})),a=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Polygon=void 0;var o=function(){function e(e,t){var o=document.createElementNS("http://www.w3.org/2000/svg","polygon"),r="";e.forEach((function(e){r+=e[0]+","+e[1]+" "})),o.setAttribute("points",r),this.node=o,this.section=t}return e.prototype.export=function(){return{type:"polygon",data:this.node.outerHTML.toString(),section:this.section}},e.prototype.import=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.innerHTML=e,this.node=t.firstChild,t.removeChild(this.node),t.remove()},e.prototype.updatePoints=function(e){var t="";e.forEach((function(e){t+=e[0]+","+e[1]+" "})),this.node.setAttribute("points",t)},e.prototype.addPoint=function(e){this.node.setAttribute("points",this.node.getAttribute("points")+(e[0]+",")+e[1]+" ")},e.prototype.setStroke=function(e){this.node.setAttribute("stroke",e)},e.prototype.setFill=function(e){this.node.setAttribute("fill",e)},e.prototype.setStrokeWidth=function(e){this.node.setAttribute("stroke-width",e.toString())},e.prototype.delete=function(){this.node.remove()},e}();t.Polygon=o})),l=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getBlankGraphPaths=void 0,t.getBlankGraphPaths=function(e,t,o){var r=e[0],s=e[1],l=new i.Path("","bg");switch(o.type){case"none":break;case"axes":var h=Math.floor(s*(o.xOffset/100)),d=Math.floor(r*(o.yOffset/100));l.setStroke(n.getRGBColorString(o.axesColor)),l.appendPath("M 0,"+d+" H "+(e[0]-1)),l.appendPath("M "+h+",0 V "+(e[1]-1));break;case"grid":var u=e[0]*(o.xSpacing/100),c=e[1]*(o.ySpacing/100);console.log(u,c),l.setStroke(n.getRGBColorString(o.lineColor));for(var p=u;p<e[0];p+=u)l.appendPath("M "+p+",0 V "+(e[1]-1));for(var g=c;g<e[1];g+=c)l.appendPath("M 0,"+g+" H "+(e[0]-1));break;case"ruled":var v="horizontal"===o.orientation?e[1]:e[0],f=v*(o.spacing/100);l.setStroke(n.getRGBColorString(o.lineColor));for(var _=f;_<v;_+=f){var S=void 0;S="horizontal"===o.orientation?"M 0,"+_+" H "+(e[0]-1):"M "+_+",0 V "+(e[1]-1),l.appendPath(S)}}var m=new a.Polygon([[0,0],[0,e[1]],[e[0],e[1]],[e[0],0]],"bg");return m.setFill(n.getRGBColorString(t)),m.setStroke(n.getRGBColorString(t)),[m,l]}})),h=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),d=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RealRendererDefaults=void 0,t.RealRendererDefaults={dimensions:[1e3,1e3],bgColor:[0,0,0],bgType:{type:"axes",axesColor:[1,1,1],xOffset:20,yOffset:20},drawsPerFrame:1,timeStep:1/60,initTime:0,scaleFactor:1}})),u=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.clamp=void 0,t.clamp=function(e,t,o){return Math.min(Math.max(e,t),o)}})),c=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.redo=t.undo=void 0,t.undo=function(e){void 0===e&&(e=1),this._strokeIndex=u.clamp(this._strokeIndex-e,0,this.strokes.length-1);for(var t=this._strokeIndex+1;t<this.strokes.length;t++)this.strokes[t].forEach((function(e){return e.delete()}));return this},t.redo=function(e){void 0===e&&(e=1);for(var t=u.clamp(e,e,this.strokes.length-this._strokeIndex-1),o=0;o<t;o++)this._strokeIndex++,this._display(this.strokes[this._strokeIndex]);return this}})),p=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Circle=void 0;var o=function(){function e(e,t,o){var r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",e[0].toString()),r.setAttribute("cy",e[1].toString()),r.setAttribute("r",t.toString()),this.node=r,this.section=o}return e.prototype.export=function(){return{type:"circle",data:this.node.outerHTML.toString(),section:this.section}},e.prototype.import=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.innerHTML=e,this.node=t.firstChild,t.removeChild(this.node),t.remove()},e.prototype.updateRadius=function(e){this.node.setAttribute("r",e.toString())},e.prototype.updateCenter=function(e){this.node.setAttribute("cx",e[0].toString()),this.node.setAttribute("cy",e[1].toString())},e.prototype.setStroke=function(e){this.node.setAttribute("stroke",e)},e.prototype.setFill=function(e){this.node.setAttribute("fill",e)},e.prototype.setStrokeWidth=function(e){this.node.setAttribute("stroke-width",e.toString())},e.prototype.setDashed=function(e){this.node.setAttribute("stroke-dasharray","2,2"),this.setStroke(e)},e.prototype.delete=function(){this.node.remove()},e}();t.Circle=o})),g=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Text=void 0;var o=function(){function e(e,t,o){var r=document.createElementNS("http://www.w3.org/2000/svg","text");r.textContent=t,r.setAttribute("x",e[0].toString()),r.setAttribute("y",e[1].toString()),this.node=r,this.section=o}return e.prototype.export=function(){return{type:"text",data:this.node.outerHTML.toString(),section:this.section}},e.prototype.import=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.innerHTML=e,this.node=t.firstChild,t.removeChild(this.node),t.remove()},e.prototype.updateText=function(e){this.node.textContent=e},e.prototype.setStyle=function(e,t){this.node.style[e]=t},e.prototype.delete=function(){this.node.remove()},e}();t.Text=o})),v=o((function(t,o){var n,v=e&&e.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),f=e&&e.__assign||function(){return(f=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var s in t=arguments[o])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},_=e&&e.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),S=e&&e.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||_(t,e,o)};Object.defineProperty(o,"__esModule",{value:!0}),o.RealRenderer=o.RealRendererTypes=void 0,o.RealRendererTypes=h,S(d,o);var m=function(e){function t(t,o){void 0===o&&(o=s.RealRendererEventList);var r=e.call(this,o)||this;switch(r._offsetX=0,r._offsetY=0,r.strokes=[],r._strokeIndex=-1,r.undo=c.undo,r.redo=c.redo,r.settings=f(f({},d.RealRendererDefaults),t),r.settings.bgType.type){case"axes":r.settings.bgType.xOffset=u.clamp(r.settings.bgType.xOffset,0,100),r.settings.bgType.yOffset=u.clamp(r.settings.bgType.yOffset,0,100);break;case"grid":r.settings.bgType.xSpacing=u.clamp(r.settings.bgType.xSpacing,0,100),r.settings.bgType.ySpacing=u.clamp(r.settings.bgType.ySpacing,0,100),0===r.settings.bgType.xSpacing&&(r.settings.bgType.xSpacing=1),0===r.settings.bgType.ySpacing&&(r.settings.bgType.ySpacing=1);break;case"ruled":r.settings.bgType.spacing=u.clamp(r.settings.bgType.spacing,0,100),0===r.settings.bgType.spacing&&(r.settings.bgType.spacing=1)}if(r.svg=r.settings.svg,r.dimensions=r.settings.dimensions,r.originalDimensions=[r.settings.dimensions[0],r.settings.dimensions[1]],r.bgColor=r.settings.bgColor,r.bgType=r.settings.bgType,r.drawsPerFrame=r.settings.drawsPerFrame,r.timeStep=r.settings.timeStep,r.time=r.settings.initTime,r.scaleFactor=r.settings.scaleFactor,void 0===r.svg)throw"No SVG Element Found";return r._setViewBox(r.dimensions,r._offsetX,r._offsetY),r.svg.setAttribute("preserveAspectRatio","none"),r.svgSections={bg:document.createElementNS("http://www.w3.org/2000/svg","g"),strokes:document.createElementNS("http://www.w3.org/2000/svg","g"),overlay:document.createElementNS("http://www.w3.org/2000/svg","g")},r.svg.appendChild(r.svgSections.bg),r.svg.appendChild(r.svgSections.strokes),r.svg.appendChild(r.svgSections.overlay),r._addStroke(l.getBlankGraphPaths(r.dimensions,r.bgColor,r.bgType)),r._display(r.strokes[r._strokeIndex]),r._doRender=!1,r}return v(t,e),t.prototype._setViewBox=function(e,t,o){this.svg.setAttribute("viewBox",t+" "+o+" "+e[0]+" "+e[1])},t.prototype._drawFunc=function(e){return this},t.prototype._draw=function(){return this.time+=this.timeStep,this._drawFunc(this.time),this},t.prototype._addStroke=function(e){this.strokes.length>this._strokeIndex+1&&this.strokes.splice(this._strokeIndex+1,this.strokes.length-this._strokeIndex),this.strokes[++this._strokeIndex]=e},t.prototype.draw=function(e){void 0===e&&(e=1);for(var t=0;t<e;t++)this._draw();return this},t.prototype.scale=function(e){this.scaleFactor=e,this.dimensions[0]=this.originalDimensions[0]/e,this.dimensions[1]=this.originalDimensions[1]/e,this.changeOffsets(this._offsetX,this._offsetY)},t.prototype.changeOffsets=function(e,t){this._offsetX=u.clamp(e,0,this.originalDimensions[0]-this.dimensions[0]),this._offsetY=u.clamp(t,0,this.originalDimensions[1]-this.dimensions[1]),this._setViewBox(this.dimensions,this._offsetX,this._offsetY)},t.prototype._render=function(){var e=this;this._doRender&&(this.draw(this.drawsPerFrame),this._display(this.strokes[this._strokeIndex]),window.requestAnimationFrame((function(){e._render()})))},t.prototype._display=function(e){var t=this;e.forEach((function(e){null==e.node.parentElement&&t.svgSections[e.section].appendChild(e.node)}))},t.prototype.startRender=function(){if(!this._doRender)return this._doRender=!0,this._render(),this},t.prototype.stopRender=function(){return this._doRender=!1,this},t.prototype.toggleRender=function(){return this._doRender=!this._doRender,this._doRender&&this._render(),this},t.prototype.exportData=function(){var e=[];return this.strokes.forEach((function(t){e.push(t.map((function(e){return e.export()})))})),{exportData:e,strokeIndex:this._strokeIndex,dimensions:this.dimensions}},t.prototype.importData=function(e){var t=this;this.strokes.forEach((function(e){e.forEach((function(e){return e.delete()}))})),this.svg.setAttribute("viewBox","0 0 "+this.dimensions[0]+" "+this.dimensions[1]),this.strokes=[],e.exportData.forEach((function(e){t.strokes.push(e.map((function(e){switch(e.type){case"circle":var t=new p.Circle([0,0],0,e.section);return t.import(e.data),t;case"path":var o=new i.Path("",e.section);return o.import(e.data),o;case"text":var r=new g.Text([0,0],"",e.section);return r.import(e.data),r;case"polygon":var s=new a.Polygon([],e.section);return s.import(e.data),s}})))})),this._strokeIndex=e.strokeIndex;for(var o=0;o<=this._strokeIndex;o++)this._display(this.strokes[o])},t.prototype.resetTime=function(){return this.time=0,this},t.prototype.reset=function(){return this.strokes=[l.getBlankGraphPaths(this.dimensions,this.bgColor,this.bgType)],this._strokeIndex=0,this.resetTime(),this._display(this.strokes[this._strokeIndex]),this},t}(r.EventEmitter);o.RealRenderer=m})),f=o((function(t,o){var r=e&&e.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var r=Array(e),s=0;for(t=0;t<o;t++)for(var n=arguments[t],i=0,a=n.length;i<a;i++,s++)r[s]=n[i];return r};Object.defineProperty(o,"__esModule",{value:!0}),o.RealDrawBoardEventList=void 0,o.RealDrawBoardEventList=r(s.RealRendererEventList,["tool-change","tool-setting-change","board-cleared","board-reset"])})),_=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getCircleNode=void 0,t.getCircleNode=function(e,t,o,r){var s=new p.Circle(e,t,r);return s.setFill(n.getRGBColorString(o)),s.setStroke(n.getRGBColorString(o)),s}})),S=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getLinePathCommand=void 0,t.getLinePathCommand=function(e,t){var o;return o="M "+e[0]+","+e[1],o+=" L "+t[0]+","+t[1]}})),m=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._onScroll=t._toolPreview=t._doStroke=t._endStroke=t._startStroke=t.BrushDefaults=t.name=void 0,t.name="brush",t.BrushDefaults={brushColor:[1,1,1],brushSize:1},t._startStroke=function(e,t){this._doPreview=!1;var o=new i.Path("","strokes");o.setStroke(n.getRGBColorString(this.toolSettings.brushColor)),o.setStrokeWidth(this.toolSettings.brushSize),this._addStroke([o]),this.strokes[this._strokeIndex].push(_.getCircleNode(e,this.toolSettings.brushSize/2-.5,this.toolSettings.brushColor,"strokes"))},t._endStroke=function(e,t){this.strokes[this._strokeIndex].push(_.getCircleNode(e,this.toolSettings.brushSize/2-.5,this.toolSettings.brushColor,"strokes")),this._doPreview=!0},t._doStroke=function(e,t){this.strokes[this._strokeIndex].push(_.getCircleNode(e,this.toolSettings.brushSize/2-.5,this.toolSettings.brushColor,"strokes")),this.strokes[this._strokeIndex][0].appendPath(S.getLinePathCommand(this._lastCoords.get(t),e))},t._toolPreview=function(e,t){var o;0==this._previewStroke.get(t).length?((o=_.getCircleNode(e,this.toolSettings.brushSize/2-.5,this.toolSettings.brushColor,"overlay")).setFill(n.getRGBColorString(this.toolSettings.brushColor)),o.setStroke(n.getRGBColorString(this.toolSettings.brushColor)),this._previewStroke.get(t).push(o)):((o=this._previewStroke.get(t)[0]).updateCenter(e),o.updateRadius(this.toolSettings.brushSize/2-.5),o.setFill(n.getRGBColorString(this.toolSettings.brushColor)),o.setStroke(n.getRGBColorString(this.toolSettings.brushColor)))},t._onScroll=function(e,t,o){this.changeToolSetting("brushSize",Math.max(1,this.toolSettings.brushSize-e)),this._toolPreview(t,o),this._display(this._previewStroke.get(o))}})),y=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._onScroll=t._toolPreview=t._doStroke=t._endStroke=t._startStroke=t.EraserDefaults=t.name=void 0,t.name="eraser",t.EraserDefaults={eraserSize:2},t._startStroke=function(e,t){var o=new i.Path("","strokes");o.setStroke(n.getRGBColorString(this.bgColor)),o.setStrokeWidth(this.toolSettings.eraserSize),this._addStroke([o]),this.strokes[this._strokeIndex].push(_.getCircleNode(e,this.toolSettings.eraserSize/2-.5,this.bgColor,"strokes"))},t._endStroke=function(e,t){this.strokes[this._strokeIndex].push(_.getCircleNode(e,this.toolSettings.eraserSize/2-.5,this.bgColor,"strokes")),this._doPreview=!0},t._doStroke=function(e,t){this.strokes[this._strokeIndex].push(_.getCircleNode(e,this.toolSettings.eraserSize/2-.5,this.bgColor,"strokes")),this.strokes[this._strokeIndex][0].appendPath(S.getLinePathCommand(this._lastCoords.get(t),e))},t._toolPreview=function(e,t){var o;0==this._previewStroke.get(t).length?((o=_.getCircleNode(e,this.toolSettings.eraserSize/2-.5,this.bgColor,"overlay")).setFill(n.getRGBColorString(this.bgColor)),o.setStroke(n.getRGBColorString(this.bgColor)),o.setDashed(n.getRGBColorString(this.bgColor.map((function(e){return 1-e})))),this._previewStroke.get(t).push(o)):((o=this._previewStroke.get(t)[0]).updateCenter(e),o.updateRadius(this.toolSettings.eraserSize/2-.5))},t._onScroll=function(e,t,o){this.changeToolSetting("eraserSize",Math.max(1,this.toolSettings.eraserSize-e)),this._toolPreview(t,o),this._display(this._previewStroke.get(o))}})),k=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._onScroll=t._toolPreview=t._doStroke=t._endStroke=t._startStroke=t.LineDefaults=t.name=void 0,t.name="line",t.LineDefaults={lineThickness:1,lineColor:[1,1,1]};var o=new Map;t._startStroke=function(e,t){this._doPreview=!1;var r=new i.Path("","strokes");r.setStroke(n.getRGBColorString(this.toolSettings.lineColor)),r.setStrokeWidth(this.toolSettings.lineThickness),this._addStroke([r]),this.strokes[this._strokeIndex].push(_.getCircleNode(e,this.toolSettings.lineThickness/2-.5,this.toolSettings.lineColor,"strokes")),this.strokes[this._strokeIndex].push(_.getCircleNode(e,this.toolSettings.lineThickness/2-.5,this.toolSettings.lineColor,"strokes")),o.set(t,e)},t._endStroke=function(e,t){this.strokes[this._strokeIndex][0].updatePath(S.getLinePathCommand(o.get(t),e)),this.strokes[this._strokeIndex][2].updateCenter(e),o.delete(t),this._doPreview=!0},t._doStroke=function(e,t){this.strokes[this._strokeIndex][0].updatePath(S.getLinePathCommand(o.get(t),e)),this.strokes[this._strokeIndex][2].updateCenter(e)},t._toolPreview=function(e,t){var o;0==this._previewStroke.get(t).length?((o=_.getCircleNode(e,this.toolSettings.lineThickness/2-.5,this.toolSettings.lineColor,"overlay")).setFill(n.getRGBColorString(this.toolSettings.lineColor)),o.setStroke(n.getRGBColorString(this.toolSettings.lineColor)),this._previewStroke.get(t).push(o)):((o=this._previewStroke.get(t)[0]).updateCenter(e),o.updateRadius(this.toolSettings.lineThickness/2-.5),o.setFill(n.getRGBColorString(this.toolSettings.lineColor)),o.setStroke(n.getRGBColorString(this.toolSettings.lineColor)))},t._onScroll=function(e,t,o){this.changeToolSetting("lineThickness",Math.max(1,this.toolSettings.lineThickness-e)),this._toolPreview(t,o),this._display(this._previewStroke.get(o))}})),w=o((function(t,o){var r=e&&e.__assign||function(){return(r=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var s in t=arguments[o])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.ToolDefaults=o.tools=void 0,o.tools={brush:m,eraser:y,line:k},o.ToolDefaults=r(r(r({},m.BrushDefaults),k.LineDefaults),y.EraserDefaults)})),b=o((function(t,o){var r=e&&e.__assign||function(){return(r=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var s in t=arguments[o])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.RealDrawBoardDefaults=void 0,o.RealDrawBoardDefaults=r(r({},d.RealRendererDefaults),{toolSettings:w.ToolDefaults,allowUndo:!1,maxUndos:10,tool:"brush"})})),C=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),E=o((function(t,o){var r=e&&e.__assign||function(){return(r=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var s in t=arguments[o])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o._resetBoard=o.clear=o.clearPreview=o.changeToolSetting=o.changeTool=void 0,o.changeTool=function(e){return this.tool=e,this._startStroke=w.tools[this.tool]._startStroke,this._doStroke=w.tools[this.tool]._doStroke,this._endStroke=w.tools[this.tool]._endStroke,this._toolPreview=w.tools[this.tool]._toolPreview,this._onScroll=w.tools[this.tool]._onScroll,this._previewStroke.forEach((function(e){e.forEach((function(e){e.delete()}))})),this._previewStroke.clear(),this.emit("tool-change",{newTool:e}),this},o.changeToolSetting=function(e,t){return this.toolSettings[e]=t,this.emit("tool-setting-change",{settingName:e,newValue:t}),this},o.clearPreview=function(){return this._previewStroke.forEach((function(e){e.forEach((function(e){e.delete()}))})),this._previewStroke.clear(),this},o.clear=function(){return this._strokeIndex=0,this._lastCoords.clear(),this.strokes.forEach((function(e){e.forEach((function(e){return e.delete()}))})),this.strokes=[l.getBlankGraphPaths(this.dimensions,this.bgColor,this.bgType)],this._display(this.strokes[this._strokeIndex]),this.emit("board-cleared",{}),this},o._resetBoard=function(){return this.bgColor=this.settings.bgColor,this.tool=this.settings.tool,this.toolSettings=r(r({},w.ToolDefaults),this.settings.toolSettings),this._lastCoords.clear(),this.stopRender(),this.emit("board-reset",{}),this}})),P=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._removeDOMEvents=t._addDOMEvents=void 0,t._addDOMEvents=function(){this.svg.addEventListener("mousedown",this._mouseDownEventListener),this.svg.addEventListener("mouseup",this._mouseUpEventListener),this.svg.addEventListener("mouseleave",this._mouseLeaveEventListener),this.svg.addEventListener("mousemove",this._previewMouseMoveEventListener),this.svg.addEventListener("wheel",this._wheelEventListener),this.svg.addEventListener("touchstart",this._touchStartEventListener),this.svg.addEventListener("touchmove",this._touchMoveEventListener),this.svg.addEventListener("touchend",this._touchEndEventListener),this.svg.addEventListener("touchmove",this._previewTouchMoveEventListener)},t._removeDOMEvents=function(){this.svg.removeEventListener("mousedown",this._mouseDownEventListener),this.svg.removeEventListener("mouseup",this._mouseUpEventListener),this.svg.removeEventListener("mouseexit",this._mouseLeaveEventListener),this.svg.removeEventListener("mousemove",this._previewMouseMoveEventListener),this.svg.removeEventListener("wheel",this._wheelEventListener),this.svg.removeEventListener("touchstart",this._touchStartEventListener),this.svg.removeEventListener("touchmove",this._touchMoveEventListener),this.svg.removeEventListener("touchend",this._touchEndEventListener),this.svg.removeEventListener("touchmove",this._previewTouchMoveEventListener)}})),R=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._getTouchCoords=t._getMouseCoords=void 0,t._getMouseCoords=function(e){var t=this.dimensions[0]/this.svg.clientWidth,o=this.dimensions[1]/this.svg.clientHeight;return[e.offsetX*t+this._offsetX,e.offsetY*o+this._offsetY]},t._getTouchCoords=function(e){var t=this.dimensions[0]/this.svg.clientWidth,o=this.dimensions[1]/this.svg.clientHeight;return[(e.clientX-this.svg.getBoundingClientRect().left+this._offsetY)*t,(e.clientY-this.svg.getBoundingClientRect().top+this._offsetY)*o]}})),x=o((function(t,o){var r,s=e&&e.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=e&&e.__assign||function(){return(n=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var s in t=arguments[o])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},i=e&&e.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),a=e&&e.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||i(t,e,o)};Object.defineProperty(o,"__esModule",{value:!0}),o.RealDrawBoard=o.RealDrawBoardTypes=o.RealRendererTypes=void 0,o.RealRendererTypes=h,o.RealDrawBoardTypes=C,a(b,o);var l=function(e){function t(t){var o=e.call(this,t,f.RealDrawBoardEventList)||this;return o.tool=b.RealDrawBoardDefaults.tool,o._lastCoords=new Map,o._doPreview=!0,o._previewStroke=new Map,o._resetBoard=E._resetBoard,o._addDOMEvents=P._addDOMEvents,o._removeDOMEvents=P._removeDOMEvents,o._startStroke=w.tools[b.RealDrawBoardDefaults.tool]._startStroke,o._endStroke=w.tools[b.RealDrawBoardDefaults.tool]._endStroke,o._doStroke=w.tools[b.RealDrawBoardDefaults.tool]._doStroke,o._toolPreview=w.tools[b.RealDrawBoardDefaults.tool]._toolPreview,o._onScroll=w.tools[b.RealDrawBoardDefaults.tool]._onScroll,o._getMouseCoords=R._getMouseCoords,o._getTouchCoords=R._getTouchCoords,o.changeToolSetting=E.changeToolSetting,o.changeTool=E.changeTool,o.clearPreview=E.clearPreview,o.clear=E.clear,o._mouseDownEventListener=function(e){if(0===e.button)if(e.ctrlKey)o.svg.addEventListener("mousemove",o._panEventListener);else{o.svg.addEventListener("mousemove",o._mouseMoveEventListener);var t=o._getMouseCoords(e);o._startStroke(t,"mouse"),o._lastCoords.set("mouse",t)}},o._mouseUpEventListener=function(e){if(0===e.button){var t=o._getMouseCoords(e);o.svg.removeEventListener("mousemove",o._mouseMoveEventListener),o.svg.removeEventListener("mousemove",o._panEventListener),o._lastCoords.has("mouse")&&(o._endStroke(t,"mouse"),o._lastCoords.delete("mouse")),o._display(o.strokes[o._strokeIndex])}},o._mouseLeaveEventListener=function(e){o.svg.removeEventListener("mousemove",o._mouseMoveEventListener),o._lastCoords.has("mouse")&&(o._endStroke(o._getMouseCoords(e),"mouse"),o._lastCoords.delete("mouse"),o._display(o.strokes[o._strokeIndex])),o.clearPreview()},o._mouseMoveEventListener=function(e){var t=o._getMouseCoords(e);o._doStroke(t,"mouse"),o._lastCoords.set("mouse",t)},o._previewMouseMoveEventListener=function(e){var t=o._getMouseCoords(e);o._doPreview&&(o._previewStroke.has("mouse")||o._previewStroke.set("mouse",[]),o._toolPreview(t,"mouse"),o._display(o._previewStroke.get("mouse"))),o._display(o.strokes[o._strokeIndex])},o._wheelEventListener=function(e){e.preventDefault(),e.ctrlKey?o.scale(Math.max(o.scaleFactor-.001*e.deltaY,1)):o._onScroll(.05*e.deltaY,o._getMouseCoords(e),"mouse")},o._panEventListener=function(e){e.ctrlKey&&o.changeOffsets(o._offsetX-e.movementX,o._offsetY-e.movementY)},o._touchStartEventListener=function(e){e.preventDefault();for(var t=0;t<e.touches.length;t++){var r=o._getTouchCoords(e.touches.item(t)),s=e.touches.item(t).identifier.toString();o._startStroke(r,s),o._lastCoords.set(s,r)}},o._touchEndEventListener=function(e){for(var t=0;t<e.changedTouches.length;t++){var r=o._getTouchCoords(e.changedTouches.item(t)),s=e.changedTouches.item(t).identifier.toString();o._endStroke(r,s),o._lastCoords.delete(s)}o.clearPreview()},o._touchMoveEventListener=function(e){for(var t=0;t<e.touches.length;t++){var r=o._getTouchCoords(e.touches.item(t));o._doStroke(r,e.touches.item(t).identifier.toString()),o._lastCoords.set(e.touches.item(t).identifier.toString(),r)}},o._previewTouchMoveEventListener=function(e){for(var t=0;t<e.touches.length;t++){var r=o._getTouchCoords(e.touches.item(t)),s=e.touches.item(t).identifier.toString();o._doPreview&&(o._previewStroke.has(s)||o._previewStroke.set(s,[]),o._toolPreview(r,s),o._display(o._previewStroke.get(s))),o._display(o.strokes[o._strokeIndex])}},o.settings=n(n({},b.RealDrawBoardDefaults),t),o.toolSettings=n(n({},w.ToolDefaults),o.settings.toolSettings),o.changeTool(o.settings.tool),o}return s(t,e),t.prototype.startRender=function(){return this._addDOMEvents(),this},t.prototype.stopRender=function(){return this._removeDOMEvents(),this},t.prototype.reset=function(){return this._resetBoard(),e.prototype.reset.call(this),this},t}(v.RealRenderer);o.RealDrawBoard=l})),M=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.renderPreview=void 0,t.renderPreview=function(e,t){var o=e.exportData,r=e.dimensions;t.setAttribute("viewBox","0 0 "+r[0]+" "+r[1]),o.forEach((function(e){e.forEach((function(e){t.innerHTML+=e.data}))}))}}));return t(o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.renderPreview=t.RealRenderer=t.RealDrawBoard=void 0,Object.defineProperty(t,"RealDrawBoard",{enumerable:!0,get:function(){return x.RealDrawBoard}}),Object.defineProperty(t,"RealRenderer",{enumerable:!0,get:function(){return v.RealRenderer}}),Object.defineProperty(t,"renderPreview",{enumerable:!0,get:function(){return M.renderPreview}})})))}));
