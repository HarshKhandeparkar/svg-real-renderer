!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).SVGRealRenderer=e()}(this,(function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function o(t,e,o){return t(o={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&o.path)}},o.exports),o.exports}var s=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Node=void 0;var o=function(){function t(t,e,o){var s=document.createElementNS("http://www.w3.org/2000/svg",e);this.strokeNodeType=o,this.node=s,this.section=t}return t.prototype._exportBasicData=function(){return{stroke:this.node.hasAttribute("stroke")?this.node.getAttribute("stroke"):null,fill:this.node.hasAttribute("fill")?this.node.getAttribute("fill"):null,strokeWidth:this.node.hasAttribute("stroke-width")?this.node.getAttribute("stroke-width"):null,dashed:!!this.node.hasAttribute("stroke-dasharray")&&{dashColor:this.node.getAttribute("stroke")},id:this.node.hasAttribute("id")?this.node.getAttribute("id"):null,class:this.node.hasAttribute("class")?this.node.getAttribute("class"):null,type:this.strokeNodeType,section:this.section}},t.prototype.importV1=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.innerHTML=t,this.node=e.firstChild,e.removeChild(this.node),e.remove()},t.prototype.import=function(t){null!==t.stroke&&this.setStroke(t.stroke),null!==t.fill&&this.setFill(t.fill),null!==t.strokeWidth&&this.node.setAttribute("stroke-width",t.strokeWidth),!1!==t.dashed&&this.setDashed(t.dashed.dashColor),null!==t.id&&this.setId(t.id),null!==t.class&&this.node.setAttribute("class",t.class)},t.prototype.setStroke=function(t){this.node.setAttribute("stroke",t)},t.prototype.setFill=function(t){this.node.setAttribute("fill",t)},t.prototype.setStrokeWidth=function(t){this.node.setAttribute("stroke-width",t.toString())},t.prototype.setDashed=function(t){this.node.setAttribute("stroke-dasharray","2,2"),this.setStroke(t)},t.prototype.setId=function(t){this.node.setAttribute("id",t)},t.prototype.setClassName=function(t){this.node.classList.add(t)},t.prototype.delete=function(){this.node.remove()},t}();e.Node=o})),n=o((function(e,o){var n,r=t&&t.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=t&&t.__assign||function(){return(i=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.Circle=void 0;var a=function(t){function e(e,o,s){var n=t.call(this,s,"circle","circle")||this,r=document.createElementNS("http://www.w3.org/2000/svg","circle");return r.setAttribute("cx",e[0].toString()),r.setAttribute("cy",e[1].toString()),r.setAttribute("r",o.toString()),n.node=r,n.section=s,n}return r(e,t),e.prototype.updateRadius=function(t){this.node.setAttribute("r",t.toString())},e.prototype.updateCenter=function(t){this.node.setAttribute("cx",t[0].toString()),this.node.setAttribute("cy",t[1].toString())},e.prototype.export=function(){return i(i({},this._exportBasicData()),{center:[this.node.getAttribute("cx"),this.node.getAttribute("cy")],radius:this.node.getAttribute("radius"),type:this.strokeNodeType})},e.prototype.import=function(t){this.node.setAttribute("cx",t.center[0]),this.node.setAttribute("cy",t.center[1]),this.node.setAttribute("r",t.radius)},e}(s.Node);o.Circle=a})),r=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getRGBColorString=void 0,e.getRGBColorString=function(t){return"rgb("+255*t[0]+", "+255*t[1]+", "+255*t[2]+")"}})),i=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getCircleNode=void 0,e.getCircleNode=function(t,e,o,s){var i=new n.Circle(t,e,s);return i.setFill(r.getRGBColorString(o)),i.setStroke(r.getRGBColorString(o)),i}})),a=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getLinePathCommand=void 0,e.getLinePathCommand=function(t,e){var o;return o="M "+t[0]+","+t[1],o+=" L "+e[0]+","+e[1]}})),u=o((function(e,o){var n,r=t&&t.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=t&&t.__assign||function(){return(i=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.Path=void 0;var a=function(t){function e(e,o){var s=t.call(this,o,"path","path")||this,n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),s.node=n,s.section=o,s}return r(e,t),e.prototype.updatePath=function(t){this.node.setAttribute("d",t)},e.prototype.appendPath=function(t){this.node.setAttribute("d",this.node.getAttribute("d")+" "+t)},e.prototype.export=function(){return i(i({},this._exportBasicData()),{d:this.node.getAttribute("d"),type:this.strokeNodeType})},e.prototype.import=function(e){t.prototype.import.call(this,e),this.node.setAttribute("d",e.d)},e}(s.Node);o.Path=a})),h=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getRadiusFromThickness=void 0,e.getRadiusFromThickness=function(t){return t/2-.5}})),d=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Tool=void 0;var o=function(){function t(t){this.RDB=t}return t.prototype._onLoad=function(){},t.prototype._startStroke=function(t,e,o){},t.prototype._doStroke=function(t,e,o){},t.prototype._endStroke=function(t,e,o){},t.prototype._toolPreview=function(t,e,o){},t.prototype._onScroll=function(t,e,o){},t.prototype._onKey=function(t){},t}();e.Tool=o})),c=o((function(e,o){var s,n=t&&t.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.Brush=o.BrushDefaults=o.name=void 0,o.name="brush",o.BrushDefaults={brushColor:[1,1,1],brushSize:1};var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._startStroke=function(t,e,o){this.RDB._doPreview=!1;var s=new u.Path("","strokes");s.setStroke(r.getRGBColorString(this.RDB.toolSettings.brushColor)),s.setStrokeWidth(this.RDB.toolSettings.brushSize),this.RDB._addStroke([s]),this.RDB._strokeIdentifierMap.set(e,this.RDB._strokeIndex),this.RDB.strokes[this.RDB._strokeIdentifierMap.get(e)].push(i.getCircleNode(t,h.getRadiusFromThickness(this.RDB.toolSettings.brushSize),this.RDB.toolSettings.brushColor,"strokes"))},e.prototype._endStroke=function(t,e,o){this.RDB.strokes[this.RDB._strokeIdentifierMap.get(e)].push(i.getCircleNode(t,h.getRadiusFromThickness(this.RDB.toolSettings.brushSize),this.RDB.toolSettings.brushColor,"strokes")),this.RDB._strokeIdentifierMap.delete(e),this.RDB._doPreview=!0},e.prototype._doStroke=function(t,e,o){this.RDB.strokes[this.RDB._strokeIdentifierMap.get(e)].push(i.getCircleNode(t,h.getRadiusFromThickness(this.RDB.toolSettings.brushSize),this.RDB.toolSettings.brushColor,"strokes")),this.RDB.strokes[this.RDB._strokeIdentifierMap.get(e)][0].appendPath(a.getLinePathCommand(this.RDB._lastCoords.get(e),t))},e.prototype._toolPreview=function(t,e,o){var s;(this.RDB._previewStroke.has(e)||this.RDB._previewStroke.set(e,[]),0==this.RDB._previewStroke.get(e).length)?((s=i.getCircleNode(t,h.getRadiusFromThickness(this.RDB.toolSettings.brushSize),this.RDB.toolSettings.brushColor,"overlay")).setFill(r.getRGBColorString(this.RDB.toolSettings.brushColor)),s.setStroke(r.getRGBColorString(this.RDB.toolSettings.brushColor)),this.RDB._previewStroke.get(e).push(s)):((s=this.RDB._previewStroke.get(e)[0]).updateCenter(t),s.updateRadius(h.getRadiusFromThickness(this.RDB.toolSettings.brushSize)),s.setFill(r.getRGBColorString(this.RDB.toolSettings.brushColor)),s.setStroke(r.getRGBColorString(this.RDB.toolSettings.brushColor)))},e.prototype._onScroll=function(t,e,o){this.RDB.changeToolSetting("brushSize",Math.max(1,this.RDB.toolSettings.brushSize-t)),null!=this.RDB._previewStroke.get(o)&&0!==this.RDB._previewStroke.get(o).length&&(this.RDB._previewStroke.get(o)[0].updateRadius(h.getRadiusFromThickness(this.RDB.toolSettings.brushSize)),this.RDB._display(this.RDB._previewStroke.get(o)))},e}(d.Tool);o.Brush=c})),l=o((function(e,o){var s,n=t&&t.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.Eraser=o.EraserDefaults=o.name=void 0,o.name="eraser",o.EraserDefaults={eraserSize:2};var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._startStroke=function(t,e,o){var s=new u.Path("","strokes");s.setStroke(r.getRGBColorString(this.RDB.bgColor)),s.setStrokeWidth(this.RDB.toolSettings.eraserSize),this.RDB._addStroke([s]),this.RDB._strokeIdentifierMap.set(e,this.RDB._strokeIndex),this.RDB.strokes[this.RDB._strokeIdentifierMap.get(e)].push(i.getCircleNode(t,h.getRadiusFromThickness(this.RDB.toolSettings.eraserSize),this.RDB.bgColor,"strokes"))},e.prototype._endStroke=function(t,e,o){this.RDB.strokes[this.RDB._strokeIdentifierMap.get(e)].push(i.getCircleNode(t,h.getRadiusFromThickness(this.RDB.toolSettings.eraserSize),this.RDB.bgColor,"strokes")),this.RDB._doPreview=!0},e.prototype._doStroke=function(t,e,o){this.RDB.strokes[this.RDB._strokeIdentifierMap.get(e)].push(i.getCircleNode(t,h.getRadiusFromThickness(this.RDB.toolSettings.eraserSize),this.RDB.bgColor,"strokes")),this.RDB.strokes[this.RDB._strokeIdentifierMap.get(e)][0].appendPath(a.getLinePathCommand(this.RDB._lastCoords.get(e),t))},e.prototype._toolPreview=function(t,e,o){var s;0==this.RDB._previewStroke.get(e).length?((s=i.getCircleNode(t,h.getRadiusFromThickness(this.RDB.toolSettings.eraserSize),this.RDB.bgColor,"overlay")).setFill(r.getRGBColorString(this.RDB.bgColor)),s.setStroke(r.getRGBColorString(this.RDB.bgColor)),s.setDashed(r.getRGBColorString(this.RDB.bgColor.map((function(t){return 1-t})))),this.RDB._previewStroke.get(e).push(s)):((s=this.RDB._previewStroke.get(e)[0]).updateCenter(t),s.updateRadius(h.getRadiusFromThickness(this.RDB.toolSettings.eraserSize)))},e.prototype._onScroll=function(t,e,o){this.RDB.changeToolSetting("eraserSize",Math.max(1,this.RDB.toolSettings.eraserSize-t)),null!=this.RDB._previewStroke.get(o)&&0!==this.RDB._previewStroke.get(o).length&&(this.RDB._previewStroke.get(o)[0].updateRadius(h.getRadiusFromThickness(this.RDB.toolSettings.eraserSize)),this.RDB._display(this.RDB._previewStroke.get(o)))},e}(d.Tool);o.Eraser=c})),p=o((function(e,o){var n,r=t&&t.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=t&&t.__assign||function(){return(i=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.Polygon=void 0;var a=function(t){function e(e,o){var s=t.call(this,o,"polygon","polygon")||this,n=document.createElementNS("http://www.w3.org/2000/svg","polygon"),r="";return e.forEach((function(t){r+=t[0]+","+t[1]+" "})),n.setAttribute("points",r),s.node=n,s.section=o,s}return r(e,t),e.prototype.updatePoints=function(t){var e="";t.forEach((function(t){e+=t[0]+","+t[1]+" "})),this.node.setAttribute("points",e)},e.prototype.addPoint=function(t){this.node.setAttribute("points",this.node.getAttribute("points")+(t[0]+",")+t[1]+" ")},e.prototype.export=function(){return i(i({},this._exportBasicData()),{points:this.node.getAttribute("points"),type:this.strokeNodeType})},e.prototype.import=function(e){t.prototype.import.call(this,e),this.node.setAttribute("points",e.points)},e}(s.Node);o.Polygon=a})),f=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.addCursor=e.destroyCursor=e.moveCursorUp=e.moveCursorDown=e.moveCursorRight=e.moveCursorLeft=void 0;var o=function(t){var e=t[0],o=t[1];return[e+o[0],o.slice(1)]},s=function(t){var e=t[0],o=t[1];return[e.slice(0,-1),e[e.length-1]+o]},n=function(t,e){var o=t[0],s=t[1],n=e([o.textContent,s.textContent]),r=n[0],i=n[1];o.textContent=r,s.textContent=i};e.moveCursorLeft=function(){this.tspans[this.cursorIndex].textContent.length>0?(n([this.tspans[this.cursorIndex],this.tspans[this.cursorIndex+1]],s),""===this.tspans[this.cursorIndex].textContent&&0!==this.cursorIndex&&this._setTspanPositioning(this.cursorSpan,"lineBreak")):this.cursorIndex>0&&(this._setTspanPositioning(this.tspans[this.cursorIndex+1],"lineBreak"),this.cursorIndex=this.lineIndexes[this.lineIndexes.indexOf(this.cursorIndex)-1],this._setTspanPositioning(this.tspans[this.cursorIndex+1],"inline"),this.cursorSpan.remove(),this.tspans[this.cursorIndex].insertAdjacentElement("afterend",this.cursorSpan),this._setTspanPositioning(this.cursorSpan,"inline"),this.lineIndexes[this.lineIndexes.indexOf(this.cursorIndex+1)]=this.cursorIndex+2)},e.moveCursorRight=function(){void 0!==this.tspans[this.cursorIndex+1]&&this.tspans[this.cursorIndex+1].textContent.length>0?(n([this.tspans[this.cursorIndex],this.tspans[this.cursorIndex+1]],o),""!==this.tspans[this.cursorIndex].textContent&&0!==this.cursorIndex&&(this._setTspanPositioning(this.cursorSpan,"inline"),this._setTspanPositioning(this.tspans[this.cursorIndex],"lineBreak"))):this.cursorIndex<this.tspans.length-2&&(this.cursorIndex=this.lineIndexes[this.lineIndexes.indexOf(this.cursorIndex)+1]-1,this.cursorSpan.remove(),this.tspans[this.cursorIndex].insertAdjacentElement("afterend",this.cursorSpan),this._setTspanPositioning(this.cursorSpan,"lineBreak"),this._setTspanPositioning(this.tspans[this.cursorIndex+1],"inline"),this.lineIndexes[this.lineIndexes.indexOf(this.cursorIndex+1)]=this.cursorIndex)},e.moveCursorDown=function(){var t=this.lineIndexes[this.lineIndexes.indexOf(this.cursorIndex)+1];if(void 0!==t){var e=this.tspans[this.cursorIndex].textContent,o=this.tspans[this.cursorIndex+1].textContent;this.tspans[this.cursorIndex].textContent=e+o;var s=this.tspans[t].textContent,n=s.length,r=Math.min(e.length-1,n-1),i=[s.slice(0,r+1),s.slice(r+1)];this.tspans[t-1].textContent=i[0],this.tspans[t].textContent=i[1],this.cursorSpan.remove(),this.tspans[t-1].insertAdjacentElement("afterend",this.cursorSpan),this._setTspanPositioning(this.tspans[t],"inline"),""===i[0]?this._setTspanPositioning(this.cursorSpan,"lineBreak"):this._setTspanPositioning(this.tspans[t-1],"lineBreak"),this.lineIndexes[this.lineIndexes.indexOf(t)]=t-1,this.lineIndexes.sort((function(t,e){return t-e})),this.cursorIndex=t-1}},e.moveCursorUp=function(){var t=this.lineIndexes[this.lineIndexes.indexOf(this.cursorIndex)-1];if(this.lineIndexes.includes(t)){var e=this.tspans[this.cursorIndex].textContent,o=this.tspans[this.cursorIndex+1].textContent;this.tspans[this.cursorIndex+1].textContent=e+o;var s=this.tspans[t].textContent,n=s.length,r=Math.min(e.length-1,n-1),i=[s.slice(0,r+1),s.slice(r+1)];this.tspans[t].textContent=i[0],this.tspans[t+1].textContent=i[1],this.cursorSpan.remove(),this.tspans[t].insertAdjacentElement("afterend",this.cursorSpan),this._setTspanPositioning(this.tspans[t+1],"inline"),this._setTspanPositioning(this.tspans[this.cursorIndex+1],"lineBreak"),this.lineIndexes[this.lineIndexes.indexOf(this.cursorIndex)]=this.cursorIndex+1,this.lineIndexes.sort((function(t,e){return t-e})),this.cursorIndex=t}},e.destroyCursor=function(){this.cursorSpan.hasAttribute("dy")&&this._setTspanPositioning(this.tspans[this.cursorIndex+1],"lineBreak"),this.cursorSpan.remove()},e.addCursor=function(){this.tspans[this.cursorIndex].insertAdjacentElement("afterend",this.cursorSpan)}})),g=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.deleteNextCharacter=e.deleteLastCharacter=e.appendText=e.getText=e._updateAfterCursorText=e._updateBeforeCursorText=e._getAfterCursorText=e._getBeforeCursorText=void 0,e._getBeforeCursorText=function(){return this.tspans[this.cursorIndex].textContent},e._getAfterCursorText=function(){return this.tspans[this.cursorIndex+1].textContent},e._updateBeforeCursorText=function(t){this.tspans[this.cursorIndex].textContent=t,""!==this.tspans[this.cursorIndex].textContent&&0!==this.cursorIndex&&(this._setTspanPositioning(this.cursorSpan,"inline"),this._setTspanPositioning(this.tspans[this.cursorIndex],"lineBreak"))},e._updateAfterCursorText=function(t){this.tspans[this.cursorIndex+1].textContent=t},e.getText=function(){return this.tspans.map((function(t){return t.textContent})).join("")},e.appendText=function(t){this._updateBeforeCursorText(this._getBeforeCursorText()+t)},e.deleteLastCharacter=function(){this._updateBeforeCursorText(this._getBeforeCursorText().slice(0,-1)),""===this._getBeforeCursorText()&&this.cursorIndex>0&&this.removeLine()},e.deleteNextCharacter=function(){this._updateAfterCursorText(this._getAfterCursorText().slice(1))}})),_=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.removeLine=e.newLine=void 0,e.newLine=function(){void 0!==this.tspans[this.cursorIndex+1]&&(this._setTspanPositioning(this.cursorSpan,"lineBreak"),this._addTspan("",this.cursorIndex+1,"spanBefore"),this.cursorIndex++,this.lineIndexes.push(this.cursorIndex),this.lineIndexes.sort((function(t,e){return t-e})))},e.removeLine=function(){var t=this.lineIndexes.splice(this.lineIndexes.indexOf(this.cursorIndex),1)[0];this.tspans[t].remove(),this.tspans.splice(t,1),this.lineIndexes=this.lineIndexes.map((function(e){return e>=t?e-1:e})),this.cursorIndex=t-1}})),v=o((function(e,o){var n,r=t&&t.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=t&&t.__assign||function(){return(i=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},a=t&&t.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var s=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],i=0,a=r.length;i<a;i++,n++)s[n]=r[i];return s};Object.defineProperty(o,"__esModule",{value:!0}),o.Text=void 0;var u=function(t){function e(e,o,s){var n=t.call(this,s,"text","text")||this;n.tspans=[],n.cursorIndex=0,n.lineIndexes=[],n.position=[0,0],n.newLine=_.newLine,n.removeLine=_.removeLine,n.addCursor=f.addCursor,n.destroyCursor=f.destroyCursor,n.moveCursorLeft=f.moveCursorLeft,n.moveCursorRight=f.moveCursorRight,n.moveCursorDown=f.moveCursorDown,n.moveCursorUp=f.moveCursorUp,n._getBeforeCursorText=g._getBeforeCursorText,n._updateBeforeCursorText=g._updateBeforeCursorText,n._getAfterCursorText=g._getAfterCursorText,n._updateAfterCursorText=g._updateAfterCursorText,n.getText=g.getText,n.appendText=g.appendText,n.deleteLastCharacter=g.deleteLastCharacter,n.deleteNextCharacter=g.deleteNextCharacter;var r=document.createElementNS("http://www.w3.org/2000/svg","text");return n.node=r,n.section=s,n.node.setAttribute("text-anchor","middle"),n._addTspan(o),n.cursorSpan=document.createElementNS("http://www.w3.org/2000/svg","tspan"),n.node.appendChild(n.cursorSpan),n.cursorSpan.classList.add("svg-real-db-text-cursor"),n.cursorSpan.style.setProperty("position","relative"),n.cursorSpan.textContent="|",n.cursorIndex=0,n._addTspan("",n.cursorIndex+1),n.lineIndexes.push(0),n.position=a(e),n.node.setAttribute("x",n.position[0].toString()),n.node.setAttribute("y",n.position[1].toString()),n}return r(e,t),e.prototype._addTspan=function(t,e,o){void 0===e&&(e=0),void 0===o&&(o="spanAfter"),this.lineIndexes=this.lineIndexes.map((function(t){return t>=e?t+1:t})),this.tspans.splice(e,0,document.createElementNS("http://www.w3.org/2000/svg","tspan"));var s=this.tspans[e];"spanAfter"===o?void 0!==this.tspans[e+1]?this.tspans[e+1].insertAdjacentElement("beforebegin",s):this.node.insertAdjacentElement("beforeend",s):void 0!==this.tspans[e-1]?this.tspans[e-1].insertAdjacentElement("afterend",s):this.node.insertAdjacentElement("afterbegin",s),s.textContent=t,s.style.setProperty("whiteSpace","pre")},e.prototype._setTspanPositioning=function(t,e){"lineBreak"===e?(t.setAttribute("x",this.position[0].toString()),t.setAttribute("dy","1.2em")):"inline"===e&&(t.removeAttribute("x"),t.removeAttribute("dy"))},e.prototype.updateTextBaseline=function(t){this.node.setAttribute("x",t[0].toString()),this.node.setAttribute("y",t[1].toString()),this.tspans.forEach((function(e){e.hasAttribute("x")&&e.setAttribute("x",t[0].toString())}))},e.prototype.setStyle=function(t,e){this.node.style.setProperty(t,e)},e.prototype.setFontSize=function(t){this.node.style.fontSize=t+"px"},e.prototype.importV1=function(e){var o=this;t.prototype.importV1.call(this,e),this.position=[Number(this.node.getAttribute("x")),Number(this.node.getAttribute("y"))],this.tspans=[],this.lineIndexes=[],this.cursorIndex=0,this.node.childNodes.forEach((function(t){if(t instanceof SVGTSpanElement){var e=o.tspans.push(t);t.hasAttribute("dy")&&o.lineIndexes.push(e-1)}})),this.lineIndexes.sort((function(t,e){return t-e}))},e.prototype.import=function(t){var e=this;this.tspans=t.tspans.map((function(t){var o=document.createElementNS("http://www.w3.org/2000/svg","tspan");return o.textContent=t.textContent,null!==t.dy&&o.setAttribute("dy",t.dy),null!==t.x&&o.setAttribute("x",t.x),e.node.append(o),o})),this.position=t.position,this.updateTextBaseline(this.position)},e.prototype.export=function(){return i(i({},this._exportBasicData()),{position:this.position,tspans:this.tspans.map((function(t){return{x:t.hasAttribute("x")?t.getAttribute("x"):null,dy:t.hasAttribute("dy")?t.getAttribute("dy"):null,textContent:t.textContent}})),type:this.strokeNodeType})},e}(s.Node);o.Text=u})),y=o((function(e,o){var r,i=t&&t.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=t&&t.__assign||function(){return(a=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.GroupNode=void 0;var h=function(t){function e(e,o){var s=t.call(this,e,"group","group")||this;s.innerNodes=[];var n=document.createElementNS("http://www.w3.org/2000/svg","g");return o.forEach((function(t){return n.appendChild(t.node)})),s.innerNodes=o,s.node=n,s.section=e,s}return i(e,t),e.prototype.export=function(){return a(a({},this._exportBasicData()),{innerNodes:this.innerNodes.map((function(t){return t.export()})),type:this.strokeNodeType})},e.prototype.import=function(t){var o=this;this.innerNodes=t.innerNodes.map((function(t){var o,s,r,i,a;switch(t.type){case"circle":var h=new n.Circle([0,0],0,null!==(o=t.section)&&void 0!==o?o:"strokes");return h.import(t),h;case"path":var d=new u.Path("",null!==(s=t.section)&&void 0!==s?s:"strokes");return d.import(t),d;case"text":var c=new v.Text([0,0],"",null!==(r=t.section)&&void 0!==r?r:"strokes");return c.import(t),c;case"group":var l=new e(null!==(i=t.section)&&void 0!==i?i:"strokes",[]);return l.import(t),l;case"polygon":var f=new p.Polygon([],null!==(a=t.section)&&void 0!==a?a:"strokes");return f.import(t),f}})),this.innerNodes.forEach((function(t){return o.node.appendChild(t.node)}))},e}(s.Node);o.GroupNode=h})),m=o((function(e,o){var s,n=t&&t.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.Line=o.LineDefaults=o.name=void 0,o.name="line",o.LineDefaults={lineThickness:1,lineColor:[1,1,1]};var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._startCoords=new Map,e}return n(e,t),e.prototype._startStroke=function(t,e,o){this.RDB._doPreview=!1,this.RDB._previewStroke.has(e)&&this.RDB._previewStroke.get(e).forEach((function(t){t.delete()}));var s=new u.Path("","strokes");s.setStroke(r.getRGBColorString(this.RDB.toolSettings.lineColor)),s.setStrokeWidth(this.RDB.toolSettings.lineThickness);var n=i.getCircleNode(t,h.getRadiusFromThickness(this.RDB.toolSettings.lineThickness),this.RDB.toolSettings.lineColor,"strokes"),a=i.getCircleNode(t,h.getRadiusFromThickness(this.RDB.toolSettings.lineThickness),this.RDB.toolSettings.lineColor,"strokes");this.RDB._addStroke([new y.GroupNode("strokes",[s,n,a])]),this.RDB._strokeIdentifierMap.set(e,this.RDB._strokeIndex),this._startCoords.set(e,t)},e.prototype._endStroke=function(t,e,o){var s=this.RDB.strokes[this.RDB._strokeIdentifierMap.get(e)][0];s.innerNodes[0].updatePath(a.getLinePathCommand(this._startCoords.get(e),t)),s.innerNodes[2].updateCenter(t),this._startCoords.delete(e),this.RDB._doPreview=!0},e.prototype._doStroke=function(t,e,o){var s=this.RDB.strokes[this.RDB._strokeIndex][0];s.innerNodes[0].updatePath(a.getLinePathCommand(this._startCoords.get(e),t)),s.innerNodes[2].updateCenter(t)},e.prototype._toolPreview=function(t,e,o){var s;0==this.RDB._previewStroke.get(e).length?((s=i.getCircleNode(t,h.getRadiusFromThickness(this.RDB.toolSettings.lineThickness),this.RDB.toolSettings.lineColor,"overlay")).setFill(r.getRGBColorString(this.RDB.toolSettings.lineColor)),s.setStroke(r.getRGBColorString(this.RDB.toolSettings.lineColor)),this.RDB._previewStroke.get(e).push(s)):((s=this.RDB._previewStroke.get(e)[0]).updateCenter(t),s.updateRadius(h.getRadiusFromThickness(this.RDB.toolSettings.lineThickness)),s.setFill(r.getRGBColorString(this.RDB.toolSettings.lineColor)),s.setStroke(r.getRGBColorString(this.RDB.toolSettings.lineColor)))},e.prototype._onScroll=function(t,e,o){this.RDB.changeToolSetting("lineThickness",Math.max(1,this.RDB.toolSettings.lineThickness-t)),null!=this.RDB._previewStroke.get(o)&&0!==this.RDB._previewStroke.get(o).length&&(this.RDB._previewStroke.get(o)[0].updateRadius(h.getRadiusFromThickness(this.RDB.toolSettings.lineThickness)),this.RDB._display(this.RDB._previewStroke.get(o)))},e}(d.Tool);o.Line=c})),x=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e._mapKeyToAction=void 0,e._mapKeyToAction=function(t,e){switch(t.key.toLowerCase()){case"backspace":e.deleteLastCharacter();break;case"delete":e.deleteNextCharacter();break;case"arrowleft":e.moveCursorLeft();break;case"arrowright":e.moveCursorRight();break;case"arrowdown":e.moveCursorDown();break;case"arrowup":e.moveCursorUp();break;case"enter":if(!t.shiftKey)return e.destroyCursor(),null;e.newLine();break;case"shift":case"control":break;default:e.appendText(t.key)}return e}})),S=o((function(e,o){var s,n=t&&t.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.TextTool=o.TextDefaults=o.name=void 0,o.name="text",o.TextDefaults={fontSize:10,fontColor:[1,1,1],textToolMode:"new"};var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._startCoords=new Map,e._selectedNode=null,e}return n(e,t),e.prototype._onLoad=function(){var t=this;this.RDB.on("tool-setting-change","text-tool-handler",(function(e){var o=e.settingName,s=e.newValue;"edit"===t.RDB.toolSettings.textToolMode&&null!==t._selectedNode&&("fontColor"===o&&t._selectedNode.setFill(r.getRGBColorString(s)),"fontSize"===o&&t._selectedNode.setFontSize(s))})),this.RDB.on("board-cleared","text-tool-handler",(function(){t.RDB.changeToolSetting("textToolMode","edit")}))},e.prototype._startStroke=function(t,e,o){if("new"===this.RDB.toolSettings.textToolMode){this.RDB._previewStroke.has(e)&&this.RDB._previewStroke.get(e).forEach((function(t){t.delete()})),this._startCoords.set(e,t);var s=new p.Polygon([t,t,t,t],"overlay");s.setDashed(r.getRGBColorString(this.RDB.bgColor.map((function(t){return 1-t})))),s.setFill("transparent"),this.RDB._previewStroke.set(e,[s])}},e.prototype._endStroke=function(t,e,o){if("new"===this.RDB.toolSettings.textToolMode){var s=this._startCoords.get(e),n=s[0],i=s[1],a=[(n+t[0])/2,(i+t[1])/2],u=new v.Text(a,"Enter Text","strokes");u.setFill(r.getRGBColorString(this.RDB.toolSettings.fontColor)),u.setFontSize(this.RDB.toolSettings.fontSize),this.RDB._addStroke([u]),this.RDB._strokeIdentifierMap.set(e,this.RDB._strokeIndex),null!==this._selectedNode&&this._selectedNode.destroyCursor(),this._selectedNode=u,this.RDB.changeToolSetting("textToolMode","edit"),this.RDB._previewStroke.has(e)&&(this.RDB._previewStroke.get(e).forEach((function(t){return t.delete()})),this.RDB._previewStroke.delete(e))}},e.prototype._doStroke=function(t,e,o){if("new"===this.RDB.toolSettings.textToolMode){var s=this.RDB._previewStroke.get(e)[0],n=this._startCoords.get(e),r=n[0],i=n[1],a=t[0],u=t[1];s.updatePoints([[r,i],[a,i],[a,u],[r,u]])}},e.prototype._onKey=function(t){"edit"===this.RDB.toolSettings.textToolMode&&null!==this._selectedNode&&(t.preventDefault(),this._selectedNode=x._mapKeyToAction(t,this._selectedNode))},e}(d.Tool);o.TextTool=i})),k=o((function(e,o){var s=t&&t.__assign||function(){return(s=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.TextTool=o.LineTool=o.EraserTool=o.BrushTool=o.ToolDefaults=void 0,o.ToolDefaults=s(s(s(s({},c.BrushDefaults),m.LineDefaults),l.EraserDefaults),S.TextDefaults);var n=c;Object.defineProperty(o,"BrushTool",{enumerable:!0,get:function(){return n.Brush}});var r=l;Object.defineProperty(o,"EraserTool",{enumerable:!0,get:function(){return r.Eraser}});var i=m;Object.defineProperty(o,"LineTool",{enumerable:!0,get:function(){return i.Line}});var a=S;Object.defineProperty(o,"TextTool",{enumerable:!0,get:function(){return a.TextTool}})})),b=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.RealRendererDefaults=void 0,e.RealRendererDefaults={bgColor:[0,0,0],bgType:{type:"axes",axesColor:[1,1,1],xOffset:20,yOffset:20},drawsPerFrame:1,timeStep:1/60,initTime:0,scaleFactor:1}})),w=o((function(e,o){var s=t&&t.__assign||function(){return(s=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.RealDrawBoardDefaults=void 0,o.RealDrawBoardDefaults=s(s({},b.RealRendererDefaults),{toolSettings:k.ToolDefaults,allowUndo:!1,maxUndos:10,tool:"brush"})})),R=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.RealRendererEventList=void 0,e.RealRendererEventList=["start-render","stop-render","change-scale","change-offsets","import"]})),B=o((function(e,o){var s=t&&t.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var s=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],i=0,a=r.length;i<a;i++,n++)s[n]=r[i];return s};Object.defineProperty(o,"__esModule",{value:!0}),o.RealDrawBoardEventList=void 0,o.RealDrawBoardEventList=s(R.RealRendererEventList,["tool-change","tool-setting-change","board-cleared","board-reset"])})),C=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getBlankGraphPaths=void 0,e.getBlankGraphPaths=function(t,e,o){var s=t[0],n=t[1],i=new u.Path("","bg");switch(o.type){case"none":break;case"axes":var a=Math.floor(n*(o.xOffset/100)),h=Math.floor(s*(o.yOffset/100));i.setStroke(r.getRGBColorString(o.axesColor)),i.appendPath("M 0,"+h+" H "+(t[0]-1)),i.appendPath("M "+a+",0 V "+(t[1]-1));break;case"grid":var d=t[0]*(o.xSpacing/100),c=t[1]*(o.ySpacing/100);i.setStroke(r.getRGBColorString(o.lineColor));for(var l=d;l<t[0];l+=d)i.appendPath("M "+l+",0 V "+(t[1]-1));for(var f=c;f<t[1];f+=c)i.appendPath("M 0,"+f+" H "+(t[0]-1));break;case"ruled":var g="horizontal"===o.orientation?t[1]:t[0],_=g*(o.spacing/100);i.setStroke(r.getRGBColorString(o.lineColor));for(var v=_;v<g;v+=_){var y=void 0;y="horizontal"===o.orientation?"M 0,"+v+" H "+(t[0]-1):"M "+v+",0 V "+(t[1]-1),i.appendPath(y)}}var m=new p.Polygon([[0,0],[0,t[1]],[t[0],t[1]],[t[0],0]],"bg");return m.setFill(r.getRGBColorString(e)),m.setStroke(r.getRGBColorString(e)),[m,i]}})),D=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.clamp=void 0,e.clamp=function(t,e,o){return Math.min(Math.max(t,e),o)}})),T=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.normalizeBG=e.changeBackground=void 0,e.changeBackground=function(t){this.bgType=t;var e=C.getBlankGraphPaths(this.dimensions,this.bgColor,this.bgType);return this.normalizeBG(),this.strokes[0].forEach((function(t){return t.delete()})),this.strokes[0]=e,this._display(this.strokes[0]),this},e.normalizeBG=function(){switch(this.bgType.type){case"axes":this.bgType.xOffset=D.clamp(this.bgType.xOffset,0,100),this.bgType.yOffset=D.clamp(this.bgType.yOffset,0,100);break;case"grid":this.bgType.xSpacing=D.clamp(this.bgType.xSpacing,0,100),this.bgType.ySpacing=D.clamp(this.bgType.ySpacing,0,100),0===this.bgType.xSpacing&&(this.bgType.xSpacing=1),0===this.bgType.ySpacing&&(this.bgType.ySpacing=1);break;case"ruled":this.bgType.spacing=D.clamp(this.bgType.spacing,0,100),0===this.bgType.spacing&&(this.bgType.spacing=1)}}})),O=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e._addStroke=e._display=e.draw=e._draw=e._drawFunc=void 0,e._drawFunc=function(t){return this},e._draw=function(){return this.time+=this.timeStep,this._drawFunc(this.time),this},e.draw=function(t){void 0===t&&(t=1);for(var e=0;e<t;e++)this._draw();return this},e._display=function(t){var e=this;t.forEach((function(t){null==t.node.parentElement&&e.svgSections[t.section].appendChild(t.node)}))},e._addStroke=function(t){this.strokes.length>this._strokeIndex+1&&this.strokes.splice(this._strokeIndex+1,this.strokes.length-this._strokeIndex),this.strokes[++this._strokeIndex]=t}})),P=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.toggleRender=e.stopRender=e.startRender=e._render=void 0,e._render=function(){var t=this;this._doRender&&(this.draw(this.drawsPerFrame),this._display(this.strokes[this._strokeIndex]),window.requestAnimationFrame((function(){t._render()})))},e.startRender=function(){return this._doRender||(this._doRender=!0,this._render(),this.emit("start-render",{})),this},e.stopRender=function(){return this._doRender=!1,this.emit("stop-render",{}),this},e.toggleRender=function(){return this._doRender=!this._doRender,this._doRender&&this._render(),this}})),E=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.EventEmitter=void 0;var o=function(){function t(t){var e=this;this.eventHandlers={},t.forEach((function(t){e.eventHandlers[t]=new Map}))}return t.prototype.on=function(t,e,o){this.eventHandlers[t].has(e)||this.eventHandlers[t].set(e,o)},t.prototype.off=function(t,e){this.eventHandlers[t].delete(e)},t.prototype.emit=function(t,e){this.eventHandlers[t].forEach((function(t){t(e)}))},t}();e.EventEmitter=o})),I=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.importData=e.exportData=void 0,e.exportData=function(){var t=[];return this.strokes.forEach((function(e){t.push(e.map((function(t){return t.export()})))})),{version:2,exportData:t,strokeIndex:this._strokeIndex,dimensions:this.dimensions,bgType:this.bgType}},e.importData=function(t){var e,o=this;this.strokes.forEach((function(t){t.forEach((function(t){return t.delete()}))})),this.svg.setAttribute("viewBox","0 0 "+this.dimensions[0]+" "+this.dimensions[1]),this.bgType=null!==(e=t.bgType)&&void 0!==e?e:this.bgType,this.strokes=[],"version"in t?2===t.version&&t.exportData.forEach((function(t){o.strokes.push(t.map((function(t){var e,o,s,r,i;switch(t.type){case"circle":var a=new n.Circle([0,0],0,null!==(e=t.section)&&void 0!==e?e:"strokes");return a.import(t),a;case"path":var h=new u.Path("",null!==(o=t.section)&&void 0!==o?o:"strokes");return h.import(t),h;case"text":var d=new v.Text([0,0],"",null!==(s=t.section)&&void 0!==s?s:"strokes");return d.import(t),d;case"group":var c=new y.GroupNode(null!==(r=t.section)&&void 0!==r?r:"strokes",[]);return c.import(t),c;case"polygon":var l=new p.Polygon([],null!==(i=t.section)&&void 0!==i?i:"strokes");return l.import(t),l}})))})):t.exportData.forEach((function(t){o.strokes.push(t.map((function(t){var e,o,s,r,i;switch(t.type){case"circle":var a=new n.Circle([0,0],0,null!==(e=t.section)&&void 0!==e?e:"strokes");return a.importV1(t.data),a;case"path":var h=new u.Path("",null!==(o=t.section)&&void 0!==o?o:"strokes");return h.importV1(t.data),h;case"text":var d=new v.Text([0,0],"",null!==(s=t.section)&&void 0!==s?s:"strokes");return d.importV1(t.data),d;case"group":var c=new y.GroupNode(null!==(r=t.section)&&void 0!==r?r:"strokes",[]);return c.importV1(t.data),c;case"polygon":var l=new p.Polygon([],null!==(i=t.section)&&void 0!==i?i:"strokes");return l.importV1(t.data),l}})))})),this._strokeIndex=t.strokeIndex;for(var s=0;s<=this._strokeIndex;s++)this._display(this.strokes[s]);return this.emit("import",{import:t}),this}})),M=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.attach=e._setViewBox=e._setSVG=void 0,e._setSVG=function(){if(void 0===this.svg)throw"No SVG Element Found";this._setViewBox(this.dimensions,this._offsetX,this._offsetY),this.svg.setAttribute("preserveAspectRatio","none"),this.svgSections={bg:document.createElementNS("http://www.w3.org/2000/svg","g"),strokes:document.createElementNS("http://www.w3.org/2000/svg","g"),overlay:document.createElementNS("http://www.w3.org/2000/svg","g")},this.svg.appendChild(this.svgSections.bg),this.svg.appendChild(this.svgSections.strokes),this.svg.appendChild(this.svgSections.overlay),this._addStroke(C.getBlankGraphPaths(this.dimensions,this.bgColor,this.bgType)),this._display(this.strokes[this._strokeIndex]),this._doRender=!1},e._setViewBox=function(t,e,o){this.svg.setAttribute("viewBox",e+" "+o+" "+t[0]+" "+t[1])},e.attach=function(t,e){return this.dimensions=e,this.originalDimensions=[e[0],e[1]],this.svg=t,this._setSVG(),this}})),j=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.changeOffsets=e.scale=void 0,e.scale=function(t){var e=this.scaleFactor;return this.scaleFactor=t,this.dimensions[0]=this.originalDimensions[0]/t,this.dimensions[1]=this.originalDimensions[1]/t,this.changeOffsets(this._offsetX,this._offsetY),this.emit("change-scale",{oldScaleFactor:e,newScaleFactor:this.scaleFactor}),this},e.changeOffsets=function(t,e){var o={x:this._offsetX,y:this._offsetY};return this._offsetX=D.clamp(t,0,this.originalDimensions[0]-this.dimensions[0]),this._offsetY=D.clamp(e,0,this.originalDimensions[1]-this.dimensions[1]),this._setViewBox(this.dimensions,this._offsetX,this._offsetY),this.emit("change-offsets",{oldOffsets:o,newOffsets:{x:this._offsetX,y:this._offsetY}}),this}})),L=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.redo=e.undo=void 0,e.undo=function(t){void 0===t&&(t=1),this._strokeIndex=D.clamp(this._strokeIndex-t,0,this.strokes.length-1);for(var e=this._strokeIndex+1;e<this.strokes.length;e++)this.strokes[e].forEach((function(t){return t.delete()}));return this},e.redo=function(t){void 0===t&&(t=1);for(var e=D.clamp(t,t,this.strokes.length-this._strokeIndex-1),o=0;o<e;o++)this._strokeIndex++,this._display(this.strokes[this._strokeIndex]);return this}})),A=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0})})),N=o((function(e,o){var s,n=t&&t.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=t&&t.__assign||function(){return(r=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},i=t&&t.__createBinding||(Object.create?function(t,e,o,s){void 0===s&&(s=o),Object.defineProperty(t,s,{enumerable:!0,get:function(){return e[o]}})}:function(t,e,o,s){void 0===s&&(s=o),t[s]=e[o]}),a=t&&t.__exportStar||function(t,e){for(var o in t)"default"===o||Object.prototype.hasOwnProperty.call(e,o)||i(e,t,o)};Object.defineProperty(o,"__esModule",{value:!0}),o.RealRenderer=o.RealRendererTypes=void 0,a(b,o),o.RealRendererTypes=A;var u=function(t){function e(e,o){void 0===o&&(o=R.RealRendererEventList);var s=t.call(this,o)||this;return s._offsetX=0,s._offsetY=0,s.strokes=[],s._strokeIndex=-1,s.undo=L.undo,s.redo=L.redo,s.exportData=I.exportData,s.importData=I.importData,s.changeBackground=T.changeBackground,s.scale=j.scale,s.changeOffsets=j.changeOffsets,s.attach=M.attach,s.draw=O.draw,s.startRender=P.startRender,s.stopRender=P.stopRender,s.toggleRender=P.toggleRender,s.normalizeBG=T.normalizeBG,s._setSVG=M._setSVG,s._setViewBox=M._setViewBox,s._drawFunc=O._drawFunc,s._draw=O._draw,s._display=O._display,s._addStroke=O._addStroke,s._render=P._render,s.settings=r(r({},b.RealRendererDefaults),e),s.bgType=s.settings.bgType,s.normalizeBG(),s.bgColor=s.settings.bgColor,s.drawsPerFrame=s.settings.drawsPerFrame,s.timeStep=s.settings.timeStep,s.time=s.settings.initTime,s.scaleFactor=s.settings.scaleFactor,s}return n(e,t),e.prototype.resetTime=function(){return this.time=0,this},e.prototype.reset=function(){return this.strokes=[C.getBlankGraphPaths(this.dimensions,this.bgColor,this.bgType)],this._strokeIndex=0,this.resetTime(),this._display(this.strokes[this._strokeIndex]),this},e}(E.EventEmitter);o.RealRenderer=u})),F=o((function(e,o){var s=t&&t.__assign||function(){return(s=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o._resetBoard=o.clear=o.clearPreview=o.changeToolSetting=o.changeTool=void 0,o.changeTool=function(t){var e=this.tool;return this.tool=t,this._previewStroke.forEach((function(t){t.forEach((function(t){t.delete()}))})),this._previewStroke.clear(),this._tools[this.tool]._onLoad(),this.emit("tool-change",{newTool:t,oldTool:e}),this},o.changeToolSetting=function(t,e){var o=this.toolSettings[t];return this.toolSettings[t]=e,this.emit("tool-setting-change",{settingName:t,newValue:e,oldValue:o}),this},o.clearPreview=function(){return this._previewStroke.forEach((function(t){t.forEach((function(t){t.delete()}))})),this._previewStroke.clear(),this},o.clear=function(){return this._strokeIndex>0&&(this._strokeIndex=0,this._lastCoords.clear(),this.strokes.forEach((function(t){t.forEach((function(t){return t.delete()}))})),this.strokes=[C.getBlankGraphPaths(this.dimensions,this.bgColor,this.bgType)],this._display(this.strokes[this._strokeIndex]),this.emit("board-cleared",{})),this},o._resetBoard=function(){return this.bgColor=this.settings.bgColor,this.tool=this.settings.tool,this.toolSettings=s(s({},k.ToolDefaults),this.settings.toolSettings),this._lastCoords.clear(),this.stopRender(),this.emit("board-reset",{}),this}})),G=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e._getTouchCoords=e._getMouseCoords=void 0,e._getMouseCoords=function(t){var e=this.dimensions[0]/this.svg.clientWidth,o=this.dimensions[1]/this.svg.clientHeight;return[t.offsetX*e+this._offsetX,t.offsetY*o+this._offsetY]},e._getTouchCoords=function(t){var e=this.dimensions[0]/this.svg.clientWidth,o=this.dimensions[1]/this.svg.clientHeight;return[(t.clientX-this.svg.getBoundingClientRect().left+this._offsetY)*e,(t.clientY-this.svg.getBoundingClientRect().top+this._offsetY)*o]}})),z=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e._removeDOMEvents=e._addDOMEvents=void 0,e._addDOMEvents=function(){this.svg.addEventListener("mousedown",this._mouseDownEventListener),this.svg.addEventListener("mouseup",this._mouseUpEventListener),this.svg.addEventListener("mouseleave",this._mouseLeaveEventListener),this.svg.addEventListener("mousemove",this._previewMouseMoveEventListener),this.svg.addEventListener("wheel",this._wheelEventListener),document.addEventListener("keydown",this._keyPressEventListener),this.svg.addEventListener("touchstart",this._touchStartEventListener),this.svg.addEventListener("touchmove",this._touchMoveEventListener),this.svg.addEventListener("touchend",this._touchEndEventListener),this.svg.addEventListener("touchmove",this._previewTouchMoveEventListener)},e._removeDOMEvents=function(){this.svg.removeEventListener("mousedown",this._mouseDownEventListener),this.svg.removeEventListener("mouseup",this._mouseUpEventListener),this.svg.removeEventListener("mouseexit",this._mouseLeaveEventListener),this.svg.removeEventListener("mousemove",this._previewMouseMoveEventListener),this.svg.removeEventListener("wheel",this._wheelEventListener),document.removeEventListener("keydown",this._keyPressEventListener),this.svg.removeEventListener("touchstart",this._touchStartEventListener),this.svg.removeEventListener("touchmove",this._touchMoveEventListener),this.svg.removeEventListener("touchend",this._touchEndEventListener),this.svg.removeEventListener("touchmove",this._previewTouchMoveEventListener)}})),V=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0})})),Y=o((function(e,o){var s,n=t&&t.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=t&&t.__assign||function(){return(r=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},i=t&&t.__createBinding||(Object.create?function(t,e,o,s){void 0===s&&(s=o),Object.defineProperty(t,s,{enumerable:!0,get:function(){return e[o]}})}:function(t,e,o,s){void 0===s&&(s=o),t[s]=e[o]}),a=t&&t.__exportStar||function(t,e){for(var o in t)"default"===o||Object.prototype.hasOwnProperty.call(e,o)||i(e,t,o)};Object.defineProperty(o,"__esModule",{value:!0}),o.RealDrawBoard=o.RealRendererTypes=o.RealDrawBoardTypes=void 0,a(w,o),o.RealDrawBoardTypes=V,o.RealRendererTypes=A;var u=function(t){function e(e){var o=t.call(this,e,B.RealDrawBoardEventList)||this;return o.tool=w.RealDrawBoardDefaults.tool,o._lastCoords=new Map,o._doPreview=!0,o._previewStroke=new Map,o._strokeIdentifierMap=new Map,o._resetBoard=F._resetBoard,o._addDOMEvents=z._addDOMEvents,o._removeDOMEvents=z._removeDOMEvents,o._getMouseCoords=G._getMouseCoords,o._getTouchCoords=G._getTouchCoords,o.changeToolSetting=F.changeToolSetting,o.changeTool=F.changeTool,o.clearPreview=F.clearPreview,o.clear=F.clear,o._mouseDownEventListener=function(t){if(0===t.button)if(t.ctrlKey)o.svg.addEventListener("mousemove",o._panEventListener);else{o.svg.addEventListener("mousemove",o._mouseMoveEventListener);var e=o._getMouseCoords(t);o._tools[o.tool]._startStroke(e,"mouse",t.target),o._lastCoords.set("mouse",e)}},o._mouseUpEventListener=function(t){if(0===t.button){var e=o._getMouseCoords(t);o.svg.removeEventListener("mousemove",o._mouseMoveEventListener),o.svg.removeEventListener("mousemove",o._panEventListener),o._lastCoords.has("mouse")&&(o._tools[o.tool]._endStroke(e,"mouse",t.target),o._lastCoords.delete("mouse")),o._display(o.strokes[o._strokeIndex])}},o._mouseLeaveEventListener=function(t){o.svg.removeEventListener("mousemove",o._mouseMoveEventListener),o._lastCoords.has("mouse")&&(o._tools[o.tool]._endStroke(o._getMouseCoords(t),"mouse",t.target),o._lastCoords.delete("mouse"),o._display(o.strokes[o._strokeIndex])),o.clearPreview()},o._mouseMoveEventListener=function(t){var e=o._getMouseCoords(t);o._tools[o.tool]._doStroke(e,"mouse",t.target),o._lastCoords.set("mouse",e)},o._previewMouseMoveEventListener=function(t){var e=o._getMouseCoords(t);o._doPreview&&(o._previewStroke.has("mouse")||o._previewStroke.set("mouse",[]),o._tools[o.tool]._toolPreview(e,"mouse",t.target),o._display(o._previewStroke.get("mouse"))),o._display(o.strokes[o._strokeIndex])},o._wheelEventListener=function(t){t.preventDefault(),t.ctrlKey?o.scale(Math.max(o.scaleFactor-.001*t.deltaY,1)):o._tools[o.tool]._onScroll(.05*t.deltaY,o._getMouseCoords(t),"mouse")},o._panEventListener=function(t){t.ctrlKey&&o.changeOffsets(o._offsetX-t.movementX,o._offsetY-t.movementY)},o._keyPressEventListener=function(t){o._tools[o.tool]._onKey(t)},o._touchStartEventListener=function(t){t.preventDefault();for(var e=0;e<t.touches.length;e++){var s=o._getTouchCoords(t.touches.item(e)),n=t.touches.item(e).identifier.toString();o._tools[o.tool]._startStroke(s,n,t.target),o._lastCoords.set(n,s)}},o._touchEndEventListener=function(t){for(var e=0;e<t.changedTouches.length;e++){var s=o._getTouchCoords(t.changedTouches.item(e)),n=t.changedTouches.item(e).identifier.toString();o._tools[o.tool]._endStroke(s,n,t.target),o._lastCoords.delete(n)}o.clearPreview()},o._touchMoveEventListener=function(t){for(var e=0;e<t.touches.length;e++){var s=o._getTouchCoords(t.touches.item(e));o._tools[o.tool]._doStroke(s,t.touches.item(e).identifier.toString(),t.target),o._lastCoords.set(t.touches.item(e).identifier.toString(),s)}},o._previewTouchMoveEventListener=function(t){for(var e=0;e<t.touches.length;e++){var s=o._getTouchCoords(t.touches.item(e)),n=t.touches.item(e).identifier.toString();o._doPreview&&(o._previewStroke.has(n)||o._previewStroke.set(n,[]),o._tools[o.tool]._toolPreview(s,n,t.target),o._display(o._previewStroke.get(n))),o._display(o.strokes[o._strokeIndex])}},o.startRender=function(){return this._addDOMEvents(),this},o.stopRender=function(){return this._removeDOMEvents(),this},o.settings=r(r(r({},w.RealDrawBoardDefaults),e),{toolSettings:r(r({},w.RealDrawBoardDefaults.toolSettings),"toolSettings"in e?e.toolSettings:{})}),o.toolSettings=r(r({},k.ToolDefaults),o.settings.toolSettings),o._tools={brush:new k.BrushTool(o),eraser:new k.EraserTool(o),line:new k.LineTool(o),text:new k.TextTool(o)},o.changeTool(o.settings.tool),o}return n(e,t),e.prototype.reset=function(){return this._resetBoard(),t.prototype.reset.call(this),this},e}(N.RealRenderer);o.RealDrawBoard=u}));return e(o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.RealRenderer=e.RealDrawBoard=void 0,Object.defineProperty(e,"RealDrawBoard",{enumerable:!0,get:function(){return Y.RealDrawBoard}}),Object.defineProperty(e,"RealRenderer",{enumerable:!0,get:function(){return N.RealRenderer}})})))}));
