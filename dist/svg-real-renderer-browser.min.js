!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).SVGRealRenderer=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function o(e,t,o){return e(o={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&o.path)}},o.exports),o.exports}var s=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getRGBColorString=void 0,t.getRGBColorString=function(e){return"rgb("+255*e[0]+", "+255*e[1]+", "+255*e[2]+")"}})),r=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Path=void 0;var o=function(){function e(e){var t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",e),this.node=t}return e.prototype.updatePath=function(e){this.node.setAttribute("d",e)},e.prototype.appendPath=function(e){this.node.setAttribute("d",this.node.getAttribute("d")+"\n"+e)},e.prototype.setStroke=function(e){this.node.setAttribute("stroke",e)},e.prototype.setFill=function(e){this.node.setAttribute("fill",e)},e.prototype.setStrokeWidth=function(e){this.node.setAttribute("stroke-width",e.toString())},e.prototype.delete=function(){this.node.remove()},e}();t.Path=o})),i=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getBlankGraphPath=void 0,t.getBlankGraphPath=function(e,t,o,i,n){var h,d=e[0],a=e[1],u=Math.floor(a*(t/100)),l=Math.floor(d*(o/100));n?(h="M 0,"+l+" H "+(e[0]-1)+" \n",h+="M "+u+",0 V "+(e[1]-1)):h="";var c=new r.Path(h);return c.setStroke(s.getRGBColorString(i)),c}})),n=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),h=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RealRendererDefaults=void 0,t.RealRendererDefaults={dimensions:[1e3,1e3],xScaleFactor:10,yScaleFactor:1,bgColor:[0,0,0],drawAxes:!0,axesColor:[1,1,1],drawsPerFrame:1,timeStep:1/60,initTime:0,xOffset:50,yOffset:50}})),d=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.redo=t.undo=void 0,t.undo=function(e){void 0===e&&(e=1),this._strokeIndex=Math.min(Math.max(this._strokeIndex-e,0),this.strokes.length-1);for(var t=this._strokeIndex+1;t<this.strokes.length;t++)this.strokes[t].forEach((function(e){return e.delete()}));return this},t.redo=function(e){void 0===e&&(e=1);for(var t=Math.min(e,this.strokes.length-this._strokeIndex-1,e),o=0;o<t;o++)this._strokeIndex++,this._display(this.strokes[this._strokeIndex]);return this}})),a=o((function(t,o){var r=e&&e.__assign||function(){return(r=Object.assign||function(e){for(var t,o=1,s=arguments.length;o<s;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=e&&e.__createBinding||(Object.create?function(e,t,o,s){void 0===s&&(s=o),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,s){void 0===s&&(s=o),e[s]=t[o]}),u=e&&e.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||a(t,e,o)};Object.defineProperty(o,"__esModule",{value:!0}),o.RealRenderer=o.RealRendererTypes=void 0,o.RealRendererTypes=n,u(h,o);var l=function(){function e(e){if(this.strokes=[],this._strokeIndex=-1,this.undo=d.undo,this.redo=d.redo,e=r(r({},h.RealRendererDefaults),e),this.svg=e.svg,this.dimensions=e.dimensions,this.xScaleFactor=e.xScaleFactor,this.yScaleFactor=e.yScaleFactor,this.bgColor=e.bgColor,this.drawAxes=e.drawAxes,this.axesColor=e.axesColor,this.drawsPerFrame=e.drawsPerFrame,this.timeStep=e.timeStep,this.time=e.initTime,this.xOffset=e.xOffset,this.yOffset=e.yOffset,this.xOffset=Math.max(0,Math.min(100,this.xOffset)),this.yOffset=Math.max(0,Math.min(100,this.yOffset)),void 0===this.svg)throw"No SVG Element Found";this.svg.setAttribute("width",this.dimensions[0].toString()),this.svg.setAttribute("height",this.dimensions[1].toString()),this.svg.style.backgroundColor=""+s.getRGBColorString(this.bgColor),this._addStroke([i.getBlankGraphPath(this.dimensions,this.xOffset,this.yOffset,this.axesColor,this.drawAxes)]),this._display(this.strokes[this._strokeIndex]),this._doRender=!1}return e.prototype._drawFunc=function(e){return this},e.prototype._draw=function(){return this.time+=this.timeStep,this._drawFunc(this.time),this},e.prototype._addStroke=function(e){this.strokes.length>this._strokeIndex+1&&this.strokes.splice(this._strokeIndex+1,this.strokes.length-this._strokeIndex),this.strokes[++this._strokeIndex]=e},e.prototype.draw=function(e){void 0===e&&(e=1);for(var t=0;t<e;t++)this._draw();return this},e.prototype._render=function(){var e=this;this._doRender&&(this.draw(this.drawsPerFrame),this._display(this.strokes[this._strokeIndex]),window.requestAnimationFrame((function(){e._render()})))},e.prototype._display=function(e){var t=this;e.forEach((function(e){null==e.node.parentElement&&t.svg.appendChild(e.node)}))},e.prototype.startRender=function(){if(!this._doRender)return this._doRender=!0,this._render(),this},e.prototype.stopRender=function(){return this._doRender=!1,this},e.prototype.toggleRender=function(){return this._doRender=!this._doRender,this._doRender&&this._render(),this},e.prototype.resetTime=function(){return this.time=0,this},e.prototype.reset=function(){return this.strokes=[[i.getBlankGraphPath(this.dimensions,this.xOffset,this.yOffset,this.axesColor,this.drawAxes)]],this._strokeIndex=0,this.resetTime(),this._display(this.strokes[this._strokeIndex]),this},e}();o.RealRenderer=l})),u=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Circle=void 0;var o=function(){function e(e,t){var o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("cx",e[0].toString()),o.setAttribute("cy",e[1].toString()),o.setAttribute("r",t.toString()),this.node=o}return e.prototype.updateRadius=function(e){this.node.setAttribute("r",e.toString())},e.prototype.updateCenter=function(e){this.node.setAttribute("cx",e[0].toString()),this.node.setAttribute("cy",e[1].toString())},e.prototype.setStroke=function(e){this.node.setAttribute("stroke",e)},e.prototype.setFill=function(e){this.node.setAttribute("fill",e)},e.prototype.setStrokeWidth=function(e){this.node.setAttribute("stroke-width",e.toString())},e.prototype.delete=function(){this.node.remove()},e}();t.Circle=o})),l=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getCircleNode=void 0,t.getCircleNode=function(e,t,o){var r=new u.Circle(e,t);return r.setFill(s.getRGBColorString(o)),r.setStroke(s.getRGBColorString(o)),r}})),c=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getLinePathCommand=void 0,t.getLinePathCommand=function(e,t){var o;return o="M "+e[0]+","+e[1]+"\n",o+="L "+t[0]+","+t[1]}})),_=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._toolPreview=t._doStroke=t._endStroke=t._startStroke=t.BrushDefaults=t.name=void 0,t.name="brush",t.BrushDefaults={brushColor:[1,1,1],brushSize:1},t._startStroke=function(e,t){this._doPreview=!1;var o=new r.Path("");o.setStroke(s.getRGBColorString(this.toolSettings.brushColor)),o.setStrokeWidth(this.toolSettings.brushSize),this._addStroke([o]),this.strokes[this._strokeIndex].push(l.getCircleNode(e,this.toolSettings.brushSize/2,this.toolSettings.brushColor))},t._endStroke=function(e,t){this.strokes[this._strokeIndex].push(l.getCircleNode(e,this.toolSettings.brushSize/2,this.toolSettings.brushColor)),this._doPreview=!0},t._doStroke=function(e,t){this.strokes[this._strokeIndex].push(l.getCircleNode(e,this.toolSettings.brushSize/2,this.toolSettings.brushColor)),this.strokes[this._strokeIndex][0].appendPath(c.getLinePathCommand(this._lastCoords.get(t),e))},t._toolPreview=function(e,t){var o;0==this._previewStroke.get(t).length?((o=l.getCircleNode(e,this.toolSettings.brushSize/2,this.toolSettings.brushColor)).setFill(s.getRGBColorString(this.toolSettings.brushColor)),o.setStroke(s.getRGBColorString(this.toolSettings.brushColor)),this._previewStroke.get(t).push(o)):((o=this._previewStroke.get(t)[0]).updateCenter(e),o.updateRadius(this.toolSettings.brushSize/2))}})),v=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._toolPreview=t._doStroke=t._endStroke=t._startStroke=t.EraserDefaults=t.name=void 0,t.name="eraser",t.EraserDefaults={eraserSize:2},t._startStroke=function(e,t){this._doPreview=!1;var o=new r.Path("");o.setStroke(s.getRGBColorString(this.bgColor)),o.setStrokeWidth(this.toolSettings.eraserSize),this._addStroke([o]),this.strokes[this._strokeIndex].push(l.getCircleNode(e,this.toolSettings.eraserSize/2,this.bgColor))},t._endStroke=function(e,t){this.strokes[this._strokeIndex].push(l.getCircleNode(e,this.toolSettings.eraserSize/2,this.bgColor)),this._doPreview=!0},t._doStroke=function(e,t){this.strokes[this._strokeIndex].push(l.getCircleNode(e,this.toolSettings.eraserSize/2,this.bgColor)),this.strokes[this._strokeIndex][0].appendPath(c.getLinePathCommand(this._lastCoords.get(t),e))},t._toolPreview=function(e,t){var o;0==this._previewStroke.get(t).length?((o=l.getCircleNode(e,this.toolSettings.eraserSize/2,this.bgColor)).setFill(s.getRGBColorString(this.bgColor)),o.setStroke(s.getRGBColorString(this.bgColor)),this._previewStroke.get(t).push(o)):((o=this._previewStroke.get(t)[0]).updateCenter(e),o.updateRadius(this.toolSettings.eraserSize/2))}})),f=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._toolPreview=t._doStroke=t._endStroke=t._startStroke=t.LineDefaults=t.name=void 0,t.name="line",t.LineDefaults={lineThickness:1,lineColor:[1,1,1]};var o=new Map;t._startStroke=function(e,t){this._doPreview=!1;var i=new r.Path("");i.setStroke(s.getRGBColorString(this.toolSettings.brushColor)),i.setStrokeWidth(this.toolSettings.brushSize),this._addStroke([i]),this.strokes[this._strokeIndex].push(l.getCircleNode(e,this.toolSettings.brushSize/2,this.toolSettings.brushColor)),this.strokes[this._strokeIndex].push(l.getCircleNode(e,this.toolSettings.brushSize/2,this.toolSettings.brushColor)),o.set(t,e)},t._endStroke=function(e,t){this.strokes[this._strokeIndex][0].updatePath(c.getLinePathCommand(o.get(t),e)),this.strokes[this._strokeIndex][2].updateCenter(e),o.delete(t),this._doPreview=!0},t._doStroke=function(e,t){this.strokes[this._strokeIndex][0].updatePath(c.getLinePathCommand(o.get(t),e)),this.strokes[this._strokeIndex][2].updateCenter(e)},t._toolPreview=function(e,t){var o;0==this._previewStroke.get(t).length?((o=l.getCircleNode(e,this.toolSettings.lineThickness/2,this.toolSettings.brushColor)).setFill(s.getRGBColorString(this.toolSettings.brushColor)),o.setStroke(s.getRGBColorString(this.toolSettings.brushColor)),this._previewStroke.get(t).push(o)):((o=this._previewStroke.get(t)[0]).updateCenter(e),o.updateRadius(this.toolSettings.lineThickness/2))}})),g=o((function(t,o){var s=e&&e.__assign||function(){return(s=Object.assign||function(e){for(var t,o=1,s=arguments.length;o<s;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.ToolDefaults=o.tools=void 0,o.tools={brush:_,eraser:v,line:f},o.ToolDefaults=s(s(s({},_.BrushDefaults),f.LineDefaults),v.EraserDefaults)})),p=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RealDrawBoardDefaults=void 0,t.RealDrawBoardDefaults={toolSettings:g.ToolDefaults,allowUndo:!1,maxUndos:10,tool:"brush"}})),S=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),k=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._resetBoard=t.clear=t.changeToolSetting=t.changeTool=void 0,t.changeTool=function(e){return this.tool=e,this._startStroke=g.tools[this.tool]._startStroke,this._doStroke=g.tools[this.tool]._doStroke,this._endStroke=g.tools[this.tool]._endStroke,this._toolPreview=g.tools[this.tool]._toolPreview,this._previewStroke.forEach((function(e){e.forEach((function(e){e.delete()}))})),this._previewStroke.clear(),this},t.changeToolSetting=function(e,t){return this.toolSettings[e]=t,this},t.clear=function(){return this._strokeIndex=0,this._lastCoords.clear(),this.strokes.forEach((function(e){e.forEach((function(e){return e.delete()}))})),this.strokes=[[i.getBlankGraphPath(this.dimensions,this.xOffset,this.yOffset,this.axesColor,this.drawAxes)]],this._display(this.strokes[this._strokeIndex]),this},t._resetBoard=function(){this.xScaleFactor=this.options.xScaleFactor,this.yScaleFactor=this.options.yScaleFactor,this.bgColor=this.options.bgColor,this.tool=this.options.tool,this.toolSettings=this.options.toolSettings,this._lastCoords.clear(),this.stopRender()}})),m=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._removeDOMEvents=t._addDOMEvents=void 0,t._addDOMEvents=function(){this.svg.addEventListener("mousedown",this._mouseDownEventListener),this.svg.addEventListener("mouseup",this._mouseUpEventListener),this.svg.addEventListener("mouseleave",this._mouseLeaveEventListener),this.svg.addEventListener("mousemove",this._previewMouseMoveEventListener),this.svg.addEventListener("touchstart",this._touchStartEventListener),this.svg.addEventListener("touchmove",this._touchMoveEventListener),this.svg.addEventListener("touchend",this._touchEndEventListener),this.svg.addEventListener("touchmove",this._previewTouchMoveEventListener)},t._removeDOMEvents=function(){this.svg.removeEventListener("mousedown",this._mouseDownEventListener),this.svg.removeEventListener("mouseup",this._mouseUpEventListener),this.svg.removeEventListener("mouseexit",this._mouseLeaveEventListener),this.svg.removeEventListener("mousemove",this._previewMouseMoveEventListener),this.svg.removeEventListener("touchstart",this._touchStartEventListener),this.svg.removeEventListener("touchmove",this._touchMoveEventListener),this.svg.removeEventListener("touchend",this._touchEndEventListener),this.svg.removeEventListener("touchmove",this._previewTouchMoveEventListener)}})),w=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._getTouchCoords=t._getMouseCoords=void 0,t._getMouseCoords=function(e){return[e.offsetX*this.dimensions[0]/this.svg.getBoundingClientRect().width,e.offsetY*this.dimensions[1]/this.svg.getBoundingClientRect().height]},t._getTouchCoords=function(e){return[(e.clientX-this.svg.getBoundingClientRect().left)*this.dimensions[0]/this.svg.getBoundingClientRect().width,(e.clientY-this.svg.getBoundingClientRect().top)*this.dimensions[1]/this.svg.getBoundingClientRect().height]}})),y=o((function(t,o){var s,r=e&&e.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=e&&e.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,s=arguments.length;o<s;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},h=e&&e.__createBinding||(Object.create?function(e,t,o,s){void 0===s&&(s=o),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,s){void 0===s&&(s=o),e[s]=t[o]}),d=e&&e.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||h(t,e,o)};Object.defineProperty(o,"__esModule",{value:!0}),o.RealDrawBoard=o.RealDrawBoardTypes=o.RealRendererTypes=void 0,o.RealRendererTypes=n,o.RealDrawBoardTypes=S,d(p,o);var u=function(e){function t(t){var o=e.call(this,t)||this;return o.tool=p.RealDrawBoardDefaults.tool,o._lastCoords=new Map,o._doPreview=!0,o._previewStroke=new Map,o._resetBoard=k._resetBoard,o._addDOMEvents=m._addDOMEvents,o._removeDOMEvents=m._removeDOMEvents,o._startStroke=g.tools[p.RealDrawBoardDefaults.tool]._startStroke,o._endStroke=g.tools[p.RealDrawBoardDefaults.tool]._endStroke,o._doStroke=g.tools[p.RealDrawBoardDefaults.tool]._doStroke,o._toolPreview=g.tools[p.RealDrawBoardDefaults.tool]._toolPreview,o._getMouseCoords=w._getMouseCoords,o._getTouchCoords=w._getTouchCoords,o.changeToolSetting=k.changeToolSetting,o.changeTool=k.changeTool,o.clear=k.clear,o._mouseDownEventListener=function(e){if(0===e.button){o.svg.addEventListener("mousemove",o._mouseMoveEventListener);var t=o._getMouseCoords(e);o._startStroke(t,"mouse"),o._lastCoords.set("mouse",t)}},o._mouseUpEventListener=function(e){if(0===e.button){var t=o._getMouseCoords(e);o.svg.removeEventListener("mousemove",o._mouseMoveEventListener),o._lastCoords.has("mouse")&&(o._endStroke(t,"mouse"),o._lastCoords.delete("mouse")),o._display(o.strokes[o._strokeIndex])}},o._mouseLeaveEventListener=function(e){o.svg.removeEventListener("mousemove",o._mouseMoveEventListener),o._lastCoords.has("mouse")&&(o._endStroke(o._getMouseCoords(e),"mouse"),o._lastCoords.delete("mouse"),o._display(o.strokes[o._strokeIndex]))},o._mouseMoveEventListener=function(e){var t=o._getMouseCoords(e);o._doStroke(t,"mouse"),o._lastCoords.set("mouse",t)},o._previewMouseMoveEventListener=function(e){var t=o._getMouseCoords(e);o._doPreview&&(o._previewStroke.has("mouse")||o._previewStroke.set("mouse",[]),o._toolPreview(t,"mouse"),o._display(o._previewStroke.get("mouse"))),o._display(o.strokes[o._strokeIndex])},o._touchStartEventListener=function(e){e.preventDefault();for(var t=0;t<e.touches.length;t++){var s=o._getTouchCoords(e.touches.item(t)),r=e.touches.item(t).identifier.toString();o._startStroke(s,r),o._lastCoords.set(r,s)}},o._touchEndEventListener=function(e){for(var t=0;t<e.changedTouches.length;t++){var s=o._getTouchCoords(e.changedTouches.item(t)),r=e.changedTouches.item(t).identifier.toString();o._endStroke(s,r),o._lastCoords.delete(r)}},o._touchMoveEventListener=function(e){for(var t=0;t<e.touches.length;t++){var s=o._getTouchCoords(e.touches.item(t));o._doStroke(s,e.touches.item(t).identifier.toString()),o._lastCoords.set(e.touches.item(t).identifier.toString(),s)}},o._previewTouchMoveEventListener=function(e){for(var t=0;t<e.touches.length;t++){var s=o._getTouchCoords(e.touches.item(t)),r=e.touches.item(t).identifier.toString();o._doPreview&&(o._previewStroke.has(r)||o._previewStroke.set(r,[]),o._toolPreview(s,r),o._display(o._previewStroke.get(r))),o._display(o.strokes[o._strokeIndex])}},t=i(i({},p.RealDrawBoardDefaults),t),o.options=t,o.toolSettings=t.toolSettings,o.changeTool(t.tool),o}return r(t,e),t.prototype.startRender=function(){return this._addDOMEvents(),this},t.prototype.stopRender=function(){return this._removeDOMEvents(),this},t.prototype.reset=function(){return this._resetBoard(),e.prototype.reset.call(this),this},t}(a.RealRenderer);o.RealDrawBoard=u}));return t(o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RealDrawBoard=t.RealRenderer=void 0,Object.defineProperty(t,"RealRenderer",{enumerable:!0,get:function(){return a.RealRenderer}}),Object.defineProperty(t,"RealDrawBoard",{enumerable:!0,get:function(){return y.RealDrawBoard}})})))}));
